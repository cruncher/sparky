<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="author" content="@stephband" />
	<meta name="description" content="" />
	<meta name="viewport" content="width=device-width" />

	<title>Sparky</title>

	<script>document.documentElement.className = 'js loading';</script>

	<link rel="icon" type="image/png" href="images/favicon.png" />
	<link rel="apple-touch-icon" href="/apple-touch-icon.png" />

	<link rel="stylesheet" href="/bolt/package/css/bolt-0.9.8.css" />
	<link rel="stylesheet" href="css/grid.css" />
</head>

<body data-fn="test-scope">
	<select id="test-select" name="name">
		<option data-fn="each" id="test-option"></option>
		<option value="0">zero</option>
		<option value="1">one</option>
	</select>

	<p>{[name]}</p>

	<script src="modules/fn/polyfills/array.find.js"></script>
	<script src="modules/fn/polyfills/array.from.js"></script>
	<script src="modules/fn/polyfills/array.of.js"></script>
	<script src="modules/fn/polyfills/number.isnan.js"></script>
	<script src="modules/fn/polyfills/math.log10.js"></script>
	<script src="modules/fn/polyfills/symbol.js"></script>
	<script src="modules/fn/polyfills/promise.js"></script>
	<script src="modules/fn/polyfills/window.requestanimationframe.js"></script>
	<script src="modules/dom/polyfills/window.customevent.js"></script>
	<script src="modules/polyfills/window.performance.js"></script>
	<script src="modules/polyfills/window.console.group.js"></script>

	<script src="modules/fn/js/fn.js"></script>
	<script src="modules/fn/js/fn.observe.js"></script>
	<script src="modules/fn/js/events.js"></script>

	<script src="modules/dom/js/dom.js"></script>

	<script src="modules/collection/js/observe.js"></script>
	<script src="modules/collection/js/collection.js"></script>
	<script src="js/sparky.js"></script>
	<script src="js/sparky.observe.js"></script>
	<script src="js/sparky.render.js"></script>
	<script src="js/sparky.parse.js"></script>
	<script src="js/sparky.fn.js"></script>
	<script src="js/sparky.fn.each.js"></script>
	<script src="js/sparky.fn.value.js"></script>
	<script src="js/sparky.filters.js"></script>

	<script>
		var Stream = Fn.Stream;
		var scopes = Stream.of({ name: [{a:1}, {a:2}, {a:3}] });
		var scope = {
			name: 'stephband'
		};

		var get    = Fn.get;
		var invoke = Fn.invoke;

		Sparky.fn['test-scope'] = function(node, scopes) {
			return Fn.of(scope);
		};

		function sanitise(node) {
			node.removeAttribute('id');
			node.removeAttribute('data-fn');
			node.removeAttribute('data-scope');
		}

		function replace(target, node) {
			target = typeof target === 'function' ? target(node) : target ;
			dom.before(target, node);
			dom.remove(target);
			return target;
		}

		function renderSelect(scopes) {
			var node = dom.find('test-select');
			var name = node.name;

			scopes
			.map(get(name))
			.each(renderEach);
		}

		function renderEach(scopes) {
			var node    = dom.find('test-option');
			var comment = dom.create('comment', ' ' + dom.tag(node) + ' ');

			dom.replace(node, comment);

console.log(scopes.length, scopes);

			Fn(scopes)
			.map(function() { return node; })
			.map(dom.clone)
			.tap(sanitise)
			.each(dom.before(comment));
		}

		renderSelect(scopes);



		function mount(data, node) {
			node

			return Fn(node.childNodes)
			.filter(function(node) {
				var ds = dom.attribute('data-scope', node);
				return !!ds;
			})
			.each(mount());
		}




		var mount = Stream.of()
		.chain(function(node) {
			dom.children(node);
		})

	</script>
</body>
</html>
