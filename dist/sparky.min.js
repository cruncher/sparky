var Sparky=function(){"use strict";!function(window){var assign=Object.assign,define=Object.defineProperty,isFrozen=Object.isFrozen,A=Array.prototype,$original=Symbol("original"),$observable=Symbol("observable"),$observers=Symbol("observers"),$update=Symbol("update"),DOMObject=window.EventTarget||window.Node,nothing=Object.freeze([]),rname=/\[?([-\w]+)(?:=(['"])?([-\w]+)\2)?\]?\.?/g;function noop(){}function isArrayLike(object){return object&&"function"!=typeof object&&object.hasOwnProperty("length")&&"number"==typeof object.length}function isObservable(object){return object&&!isFrozen(object)&&!DOMObject.prototype.isPrototypeOf(object)&&!(object instanceof Date)&&!(object instanceof RegExp)&&!(object instanceof Map)&&!(object instanceof WeakMap)&&!(object instanceof Set)&&!(window.WeakSet&&object instanceof WeakSet)&&!ArrayBuffer.isView(object)}function getObservers(object,name){return object[$observers][name]||(object[$observers][name]=[])}function removeObserver(observers,fn){var i=observers.indexOf(fn);observers.splice(i,1)}function fire(observers,value,record){if(observers)for(var n=-1;observers[++n];)observers[n](value,record)}var createProxy=window.Proxy?function(){function trapGet(target,name,self){var value=target[name];return"symbol"==typeof name?value:Observable(value)||value}var arrayHandlers={get:trapGet,set:function(target,name,value,receiver){if("symbol"==typeof name)return target[name]=value,!0;var old=target[name],length=target.length;if(old===value)return!0;var change,observers=target[$observers];if("length"===name){if(value>=target.length)return!0;for(change={index:value,removed:A.splice.call(target,value),added:nothing};--old>=value;)fire(observers[old],void 0)}else if(+name%1==0)if(name=+name,void 0===value){if(!(name<target.length))return!0;change={index:name,removed:A.splice.call(target,name,1),added:nothing},value=target[name]}else change={index:name,removed:A.splice.call(target,name,1,value),added:[value]};else target[name]=value;return target.length!==length&&fire(observers.length,target.length),fire(observers[name],Observable(value)||value),fire(observers[$update],receiver,change),!0}},objectHandlers={get:trapGet,set:function(target,name,value,receiver){if(target[name]===value)return!0;var observers=target[$observers],change={name:name,removed:target[name],added:value};return target[name]=value,fire(observers[name],Observable(value)||value),fire(observers[$update],receiver,change),!0}};return function(object){var proxy=new Proxy(object,isArrayLike(object)?arrayHandlers:objectHandlers);return define(object,$observers,{value:{}}),define(object,$observable,{value:proxy}),proxy}}():function(){function ArrayProxy(array){this[$observable]=this,this[$original]=array,this[$observers]=array[$observers],assign(this,array),this.length=array.length}return define(ArrayProxy.prototype,"length",{set:function(length){var array=this[$original];if(!(length>=array.length)){for(;--array.length>length;)this[array.length]=void 0;this[array.length]=void 0,notify(this,"")}},get:function(){return this[$original].length},configurable:!0}),assign(ArrayProxy.prototype,{filter:function(){return A.filter.apply(this[$original],arguments)},find:function(){return A.find.apply(this[$original],arguments)},map:function(){return A.map.apply(this[$original],arguments)},reduce:function(){return A.reduce.apply(this[$original],arguments)},concat:function(){return A.concat.apply(this[$original],arguments)},slice:function(){return A.slice.apply(this[$original],arguments)},some:function(){return A.some.apply(this[$original],arguments)},indexOf:function(){return A.indexOf.apply(this[$original],arguments)},forEach:function(){return A.forEach.apply(this[$original],arguments)},toJSON:function(){return this[$original]},sort:function(){return A.sort.apply(this[$original],arguments),assign(this,array),this.length=array.length,notify(this,""),this},push:function(){var array=this[$original],value=A.push.apply(array,arguments);return assign(this,array),this.length=array.length,console.log("PUSH",JSON.stringify(arguments)),notify(this,""),value},pop:function(){var array=this[$original],value=A.pop.apply(array,arguments);return assign(this,array),this.length=array.length,notify(this,""),value},shift:function(){var array=this[$original],value=A.shift.apply(array,arguments);return assign(this,array),this.length=array.length,notify(this,""),value},splice:function(){var array=this[$original],value=A.splice.apply(array,arguments);return assign(this,array),this.length=array.length,notify(this,""),value}}),function(object){var proxy;return isArrayLike(object)?(define(object,$observers,{value:{}}),proxy=isArrayLike(object)?new ArrayProxy(object):object):proxy=object,define(object,$observable,{value:proxy}),proxy}}();function observePrimitive(object,fn){return object!==fn.value&&(fn.value=object,fn(object)),noop}function observeObject(object,fn){var observers=getObservers(object,$update),old=fn.value;return observers.push(fn),object!==fn.value&&(fn.value=object,fn(object,{index:0,removed:old||nothing,added:object})),function(){removeObserver(observers,fn)}}var observeProperty=window.Proxy?function(object,name,path,fn){var observers=getObservers(object,name),unobserve=noop;function update(value){unobserve(),unobserve=observe(value,path,fn)}return observers.push(update),update(object[name]),function(){unobserve(),removeObserver(observers,update)}}:function(object,name,path,fn){var unobserve=noop;function update(value){unobserve(),unobserve=observe(value,path,fn)}var _unobserve=window.observe(object[$observable]||object,name,update);return update(object[name]),function(){unobserve(),_unobserve()}};function observe(object,path,fn){if(!path.length)return object&&object[$observable]&&object[$observers]?observeObject(object,fn):observePrimitive(object,fn);if(!object||"object"!=typeof object)return observePrimitive(void 0,fn);rname.lastIndex=0;var tokens=rname.exec(path);if(!tokens)throw new Error('Observable: invalid path "'+path+'"');var name=tokens[1],match=tokens[3]&&(tokens[2]?tokens[3]:parseFloat(tokens[3]));return path=path.slice(rname.lastIndex),object[$observable]?match?function(object,key,match,path,fn){var unobserve=noop;function isMatch(item){return item[key]===match}var unobserveObject=observeObject(object,function(array){var value=array&&A.find.call(array,isMatch);unobserve(),unobserve=observe(value,path,fn)});return function(){unobserve(),unobserveObject()}}(object,name,match,path,fn):observeProperty(object,name,path,fn):match?function(object,key,match,path,fn){var value=object&&A.find.call(object,function(item){return item[key]===match});return observe(Observable(value)||value,path,fn)}(object,name,match,path,fn):function(object,name,path,fn){return observe(Observable(object[name])||object[name],path,fn)}(object,name,path,fn)}function Observable(object){return object?object[$observable]?object[$observable]:isObservable(object)?createProxy(object):void 0:void 0}Observable.isObservable=isObservable,Observable.notify=function(object,path){var observers=object[$observers];fire(observers[path],object[$observable]),fire(observers[$update],object)},Observable.observe=function(object,path,fn){return observe(Observable(object)||object,path+"",fn)},Observable.filter=function(fn,array){var subset=Observable([]);return Observable.observe(array,"",function(){var filtered=array.filter(fn);assign(subset,filtered),subset.length=filtered.length}),subset},Observable.map=function(fn,array){var subset=Observable([]);return Observable.observe(array,"",function(observable){var filtered=array.map(fn);assign(subset,filtered),subset.length=filtered.length}),subset},window.Observable=Observable}(window);const DEBUG$1=!1;function cache(fn){var map=new Map;return function(object){if(DEBUG$1&&arguments.length>1)throw new Error("Fn: cache() called with "+arguments.length+" arguments. Accepts exactly 1.");if(map.has(object))return map.get(object);var value=fn(object);return map.set(object,value),value}}const A=Array.prototype;function applyFn(fn,args){return"function"==typeof fn?fn.apply(null,args):fn}function curry(fn,muteable,arity){var memo=1===(arity=arity||fn.length)?muteable?fn:cache(fn):cache(function(object){return curry(function(){var args=[object];return args.push.apply(args,arguments),fn.apply(null,args)},muteable,arity-1)});return function partial(object){return 0===arguments.length?partial:1===arguments.length?memo(object):arguments.length===arity?fn.apply(null,arguments):arguments.length>arity?applyFn(fn.apply(null,A.splice.call(arguments,0,arity)),arguments):applyFn(memo(object),A.slice.call(arguments,1))}}{const _curry=curry,isFunctionLengthDefineable=function(){var fn=function(){};try{Object.defineProperty(fn,"length",{value:2})}catch(e){return!1}return 2===fn.length}(),setFunctionProperties=function(text,parity,fn1,fn2){return fn2.toString=function(){return/function\s*[\w\d]*\s*\([,\w\d\s]*\)/.exec(fn1.toString())+" { ["+text+"] }"},isFunctionLengthDefineable&&Object.defineProperty(fn2,"length",{value:parity}),fn2};curry=function(fn,muteable,arity){return arity=arity||fn.length,setFunctionProperties("curried",arity,fn,_curry(fn,muteable,arity))}}var curry$1=curry;function rest(i,object){if(object.slice)return object.slice(i);if(object.rest)return object.rest(i);for(var a=[],n=object.length-i;n--;)a[n]=object[n+i];return a}function compose$1(fn2,fn1){return function(){return fn2(fn1.apply(null,arguments))}}function deprecate(fn,message){return function(){return console.warn("Deprecation warning: "+message),fn.apply(this,arguments)}}function id(object){return object}function isDefined(value){return!!value||void 0!==value&&null!==value&&!Number.isNaN(value)}function latest(source){var value=source.shift();return void 0===value?arguments[1]:latest(source,value)}function noop$1(){}var nothing$1=Object.freeze(Object.defineProperties([],{shift:{value:noop$1}}));function now(){return+new Date/1e3}function overload(fn,map){return"function"==typeof map.get?function(){var key=fn.apply(null,arguments);return map.get(key).apply(this,arguments)}:function(){var key=fn.apply(null,arguments);return(map[key]||map.default).apply(this,arguments)}}const A$1=Array.prototype;function call(value,fn){return fn(value)}function pipe(){const fns=arguments;return function(value){return A$1.reduce.call(fns,call,value)}}const resolved=Promise.resolve();function requestTick(fn){return resolved.then(fn),!0}function toArray$1(object){if(object.toArray)return object.toArray();var i,array=[],l=object.length;if("number"!=typeof object.length)return array;for(array.length=l,i=0;i<l;i++)array[i]=object[i];return array}function toInt(object){return void 0===object?void 0:parseInt(object,10)}function toString(object){return object.toString()}function toType(object){return typeof object}const assign=Object.assign;function isDone(source){return 0===source.length||"done"===source.status}function create(object,fn){var functor=Object.create(object);return functor.shift=fn,functor}function Fn$1(fn){if(!this||!Fn$1.prototype.isPrototypeOf(this))return new Fn$1(fn);var source=this;if(fn){var value=fn();void 0!==value?this.shift=function(){if("done"!==source.status){var v=value;return void 0===(value=fn())&&(source.status="done"),v}}:source.status="done"}else source.status="done"}function each(fn,object){var l,n;if("function"==typeof object.each)object.each(fn);else for(l=object.length,n=-1;++n<l;)fn(object[n]);return object}function Timer(duration,getTime){if("number"!=typeof duration)throw new Error("Timer(duration) requires a duration in seconds ("+duration+")");var id,fns=[],t0=-1/0;function frame(){var n=fns.length;for(id=void 0,t0=getTime();n--;)fns.shift()(t0)}return{now:getTime=getTime||now,request:function(fn){if("function"!=typeof fn)throw new Error("fn is not a function.");if(fns.push(fn),!id){var t1=getTime();return t0+duration>t1?id=setTimeout(frame,1e3*(t0+duration-t1)):requestTick(frame),fn}},cancel:function(fn){var i=fns.indexOf(fn);-1!==i&&(fns.splice(i,1),fns.length||(clearTimeout(id),id=void 0))}}}assign(Fn$1,{of:function(){return Fn$1.from(arguments)},from:function(object){var i;if("number"==typeof object.length)return i=-1,new Fn$1(function shiftArray(){return++i>=object.length?void 0:void 0===object[i]?shiftArray():object[i]});if("function"==typeof object.shift&&void 0===object.length)return new Fn$1(function(){return object.shift()});if("function"==typeof object.next)return new Fn$1(function shiftIterator(){var result=object.next();return result.done?result.value:void 0===result.value?shiftIterator():result.value});throw new Error("Fn: from(object) object is not a list of a known kind (array, functor, stream, iterator).")}}),assign(Fn$1.prototype,{shift:noop$1,of:function(){return this.constructor.of.apply(this.constructor,arguments)},ap:function(object){var shift=this.shift;return create(this,function(){var fn=shift();return void 0===fn?void 0:object.map(fn)})},unshift:function(){var source=this,buffer=toArray(arguments);return create(this,function(){return(buffer.length?buffer:source).shift()})},catch:function(fn){var source=this;return create(this,function(){try{return source.shift()}catch(e){return fn(e)}})},chain:function(fn){return this.map(fn).join()},clone:function(){var source=this,shift=this.shift,buffer1=[],buffer2=[],doneFlag=!1;return this.shift=function(){var value;return buffer1.length?(value=buffer1.shift(),!buffer1.length&&doneFlag&&(source.status="done"),value):doneFlag?void 0:(value=shift(),"done"===source.status&&(doneFlag=!0),void 0!==value&&buffer2.push(value),value)},new Fn$1(function(){var value;return buffer2.length?buffer2.shift():doneFlag?void 0:(value=shift(),"done"===source.status&&(doneFlag=!0,source.status=void 0),void 0!==value&&buffer1.push(value),value)})},concat:function(){var sources=toArray(arguments),source=this,stream=create(this,function concat(){if(void 0!==source){if(isDone(source))return source=sources.shift(),concat();var value=source.shift();return stream.status=0===sources.length&&isDone(source)?"done":void 0,value}stream.status="done"});return stream},dedup:function(){var v;return this.filter(function(value){var old=v;return v=value,old!==value})},filter:function(fn){var source=this;return create(this,function(){for(var value;void 0!==(value=source.shift())&&!fn(value););return value})},first:function(){var source=this;return create(this,once(function(){return source.status="done",source.shift()}))},join:function(){var source=this,buffer=nothing;return create(this,function join(){var value=buffer.shift();return void 0!==value?value:void 0!==(buffer=source.shift())?join():void(buffer=nothing)})},latest:function(){var source=this;return create(this,function(){return latest(source)})},map:function(fn){return create(this,compose$1(function(object){return void 0===object?void 0:fn(object)},this.shift))},chunk:function(n){var source=this,buffer=[];return create(this,n?function(){for(var value,_buffer;buffer.length<n;){if(void 0===(value=source.shift()))return;buffer.push(value)}if(buffer.length>=n)return _buffer=buffer,buffer=[],Fn$1.of.apply(Fn$1,_buffer)}:function(){return(buffer=source.toArray()).length?buffer:void 0})},fold:function(fn,seed){var i=0;return this.map(function(value){return seed=fn(seed,value,i++)}).unshift(seed)},partition:function(fn){var source=this,buffer=[],streams=new Map;function createPart(key,value){var stream=Stream.of().on("pull",shiftPull);return stream.key=key,streams.set(key,stream),stream}function shiftPull(type,pullStream){var value=source.shift();if(void 0!==value){var key=fn(value),stream=streams.get(key);return stream===pullStream?value:(void 0===stream&&(stream=createPart(key),buffer.push(stream)),stream.push(value),shiftPull(type,pullStream))}}return fn=fn||Fn$1.id,create(this,function shiftStream(){if(buffer.length)return buffer.shift();var value=source.shift();if(void 0!==value){var key=fn(value),stream=streams.get(key);return void 0===stream?((stream=createPart(key)).push(value),stream):(stream.push(value),shiftStream())}})},reduce:function(fn,seed){return this.fold(fn,seed).latest().shift()},take:function(n){var source=this,i=0;return create(this,function(){var value;if(i<n){if(void 0===(value=source.shift()))return;return++i===n&&(source.status="done"),value}})},sort:function(fn){fn=fn||Fn$1.byGreater;var source=this,buffer=[];return create(this,function(){for(var value;void 0!==(value=source.shift());)sortedSplice(buffer,fn,value);return buffer.shift()})},split:function(fn){var source=this,buffer=[];return create(this,function split(){var temp,value=source.shift();return void 0===value?buffer.length?(temp=buffer,buffer=[],temp):void 0:fn(value)?(temp=buffer,buffer=[value],temp.length?temp:split()):(buffer.push(value),split())})},syphon:function(fn){var shift=this.shift,buffer1=[],buffer2=[];return this.shift=function(){if(buffer1.length)return buffer1.shift();for(var value;void 0!==(value=shift())&&fn(value);)buffer2.push(value);return value},create(this,function(){if(buffer2.length)return buffer2.shift();for(var value;void 0!==(value=shift())&&!fn(value);)buffer1.push(value);return value})},rest:function(i){var source=this;return create(this,function(){for(;i-- >0;)source.shift();return source.shift()})},unique:function(){var source=this,values=[];return create(this,function unique(){var value=source.shift();return void 0===value?void 0:-1===values.indexOf(value)?(values.push(value),value):unique()})},each:function(fn){for(var value;void 0!==(value=this.shift());)fn.call(this,value);return this},find:function(fn){return this.filter(fn).first().shift()},next:function(){return{value:this.shift(),done:this.status}},pipe:function(stream){if(!stream||!stream.on)throw new Error("Fn: Fn.pipe(object) object must be a stream. ("+stream+")");return stream.on("pull",this.shift)},tap:function(fn){return this.shift=Fn$1.compose(tap(fn),this.shift),this},toJSON:function(){return this.reduce(arrayReducer,[])},toString:function(){return this.reduce(prepend,"")},process:deprecate(function(fn){return fn(this)},".process() is deprecated"),last:deprecate(function(){var source=this;return create(this,function(){return latest(source)})},".last() is now .latest()")}),Fn$1.prototype.toArray=Fn$1.prototype.toJSON,window.Symbol&&(Fn$1.prototype[Symbol.iterator]=function(){return this});var debug=!1,A$2=Array.prototype,assign$1=Object.assign;function call$1(value,fn){return fn(value)}function isValue(n){return void 0!==n}function isDone$1(stream){return"done"===stream.status}var $events=Symbol("events");function notify$1(type,object){var events=object[$events];if(events&&events[type])for(var value,n=-1,l=events[type].length;++n<l;)if(void 0!==(value=events[type][n](type,object)))return value}var doneSource={shift:noop$1,push:noop$1,start:noop$1,stop:noop$1};function StopSource(source,n,done){this.source=source,this.n=n,this.done=done}function Stream$1(Source,options){if(!Stream$1.prototype.isPrototypeOf(this))return new Stream$1(Source,options);var getSource,stream=this,promise=new Promise(function(resolve,reject){var source;function done(){stream.status="done",source=doneSource}function stop(n,value){delete stream[$events],n?source=new StopSource(source,n,done):done(),resolve(value)}getSource=function(){var notify=function(stream){var _notify=notify$1;return function(type){var notify=_notify;_notify=noop$1;var value=notify(type,stream);return _notify=notify,value}}(stream);return source=new Source(notify,stop,options),debug&&function(source){if(!source.shift)throw new Error("Stream: Source must create an object with .shift() "+source)}(source),source.stop||(source.stop=noop$1),getSource=function(){return source},source}});this[$events]={},this.push=function(){var source=getSource();return source.push.apply(source,arguments),stream},this.shift=function(){return getSource().shift()},this.start=function(){var source=getSource();return source.start.apply(source,arguments),stream},this.stop=function(){var source=getSource();return source.stop.apply(source,arguments),stream},this.then=promise.then.bind(promise)}function BufferSource(notify,stop,buffer){this._buffer=buffer,this._notify=notify,this._stop=stop}function toValue(data){var source=data.source,value=data.value;return data.value=void 0===value?latest(source):value}function CombineSource(notify,stop,fn,sources){var object=this;this._notify=notify,this._stop=stop,this._fn=fn,this._sources=sources,this._hot=!0,this._store=sources.map(function(source){var data={source:source,listen:listen};function listen(){data.value=void 0,object._hot=!0}return source.on("push",listen),source.on("push",notify),data})}function MergeSource(notify,stop,sources){var values=[],buffer=[];function update(type,source){buffer.push(source)}this._notify=notify,this._stop=stop,this._sources=sources,this._values=values,this._buffer=buffer,this._i=0,this._update=update,each(function(source){values.push.apply(values,toArray$1(source)),source.on("push",update),source.on("push",notify)},sources)}assign$1(StopSource.prototype,doneSource,{shift:function(){return--this.n<1&&this.done(),this.source.shift()}}),assign$1(BufferSource.prototype,{shift:function(){var buffer=this._buffer,notify=this._notify;return buffer.length?buffer.shift():notify("pull")},push:function(){var buffer=this._buffer,notify=this._notify;buffer.push.apply(buffer,arguments),notify("push")},stop:function(){var buffer=this._buffer;this._stop(buffer.length)}}),Stream$1.from=function(source){return new Stream$1(function(notify,stop){return new BufferSource(notify,stop,void 0===source?[]:Fn$1.prototype.isPrototypeOf(source)?source:Array.from(source).filter(isValue))})},Stream$1.of=function(){return Stream$1.from(arguments)},assign$1(CombineSource.prototype,{shift:function(){if(this._hot){this._hot=!1;var sources=this._sources,values=this._store.map(toValue);return sources.every(isDone$1)&&this._stop(0),values.every(isValue)&&this._fn.apply(null,values)}},stop:function(){var notify=this._notify;each(function(data){var source=data.source,listen=data.listen;source.off("push",listen),source.off("push",notify)},this._store),this._stop(this._hot?1:0)}}),Stream$1.Combine=function(fn){var sources=A$2.slice.call(arguments,1);if(sources.length<2)throw new Error("Stream: Combine requires more than "+sources.length+" source streams");return new Stream$1(function(notify,stop){return new CombineSource(notify,stop,fn,sources)})},assign$1(MergeSource.prototype,{shift:function(){var sources=this._sources,values=this._values,buffer=this._buffer,stop=this._stop;if(values.length)return values.shift();var stream=buffer.shift();if(stream){var value=stream.shift();return"done"===stream.status&&++this._i>=sources.length&&stop(0),value}},stop:function(){var notify=this._notify,sources=this._sources,stop=this._stop,update=this._update;each(function(source){source.off("push",update),source.off("push",notify)},sources),stop(values.length+buffer.length)}}),Stream$1.Merge=function(source1,source2){var args=arguments;return new Stream$1(function(notify,stop){return new MergeSource(notify,stop,Array.from(args))})},Stream$1.Events=function(type,node){return new Stream$1(function(notify,stop){var buffer=[];function update(value){buffer.push(value),notify("push")}return node.addEventListener(type,update),{shift:function(){return buffer.shift()},stop:function stop(){node.removeEventListener(type,update),stop(buffer.length)}}})},Stream$1.Choke=function(time){return new Stream$1(function(notify,done){var value,update=function(fn,time){var timer,context,args,cue=function(){timer&&clearTimeout(timer),timer=setTimeout(update,1e3*(time||0))};function update(){timer=!1,fn.apply(context,args)}function wait(){context=this,args=arguments,cue()}return wait.cancel=function(){cue=noop,timer&&clearTimeout(timer)},wait}(function(){value=arguments[arguments.length-1],notify("push")},time);return{shift:function(){var v=value;return value=void 0,v},push:update,stop:function(){update.cancel(!1),done()}}})};var frameTimer={now:now,request:requestAnimationFrame.bind(window),cancel:cancelAnimationFrame.bind(window)};function StreamTimer(stream){var timer=this,fns0=[],fns1=[];this.fns=fns0,stream.each(function(){timer.fns=fns1,fns0.reduce(call$1,void 0),fns0.length=0,fns1=fns0,fns0=timer.fns})}function schedule(){var timer=this.timer;this.queue=noop$1,this.ref=timer.request(this.update)}function ThrottleSource(notify,stop,timer){var source=this;this._stop=stop,this.timer=timer,this.queue=schedule,this.update=function(){source.queue=schedule,notify("push")}}function ClockSource(notify,stop,options){var source=this,request=options.request;this.cancel=options.cancel||noop$1,this.end=stop,this.id=request(function frame(time){source.value=time,notify("push"),source.value=void 0,source.id=request(frame)})}function set(key,object,value){return"function"==typeof object.set?object.set(key,value):object[key]=value}assign$1(StreamTimer.prototype,{request:function(fn){return this.fns.push(fn),fn},cancel:function(fn){remove(this.fns,fn)}}),assign$1(ThrottleSource.prototype,{shift:function(){var value=this.value;return this.value=void 0,value},stop:function(callLast){var timer=this.timer;this.queue===noop$1&&(timer.cancel&&timer.cancel(this.ref),this.ref=void 0),this.queue=noop$1,this._stop(void 0!==this.value&&callLast?1:0)},push:function(){this.value=arguments[arguments.length-1],this.queue()}}),Stream$1.throttle=function(timer){if("function"==typeof timer)throw new Error("Dont accept request and cancel functions anymore");return timer="number"==typeof timer?new Timer(timer):timer instanceof Stream$1?new StreamTimer(timer):timer||frameTimer,new Stream$1(function(notify,stop){return new ThrottleSource(notify,stop,timer)})},assign$1(ClockSource.prototype,{shift:function(){var value=this.value;return this.value=void 0,value},stop:function(){(0,this.cancel)(this.id),this.end()}}),Stream$1.clock=function(options){return new Stream$1(ClockSource,"number"==typeof options?new Timer(options):options||frameTimer)},Stream$1.prototype=assign$1(Object.create(Fn$1.prototype),{clone:function(){var source=this,shift=this.shift,buffer1=[],buffer2=[],stream=new Stream$1(function(notify,stop){var buffer=buffer2;return source.on("push",notify),{shift:function(){if(buffer.length)return buffer.shift();var value=shift();return void 0!==value?buffer1.push(value):"done"===source.status&&(stop(0),source.off("push",notify)),value},stop:function(){for(var value;void 0!==(value=shift());)buffer.push(value),buffer1.push(value);stop(buffer.length),source.off("push",notify)}}});return this.then(stream.stop),this.shift=function(){if(buffer1.length)return buffer1.shift();var value=shift();return void 0!==value&&"done"!==stream.status&&buffer2.push(value),value},stream},combine:function(fn,source){return Stream$1.Combine(fn,this,source)},merge:function(){var sources=toArray$1(arguments);return sources.unshift(this),Stream$1.Merge.apply(null,sources)},choke:function(time){return this.pipe(Stream$1.Choke(time))},throttle:function(timer){return this.pipe(Stream$1.throttle(timer))},clock:function(timer){return this.pipe(Stream$1.clock(timer))},each:function(fn){var args=arguments,source=this;return Fn$1.prototype.each.apply(source,args),this.on("push",function(){Fn$1.prototype.each.apply(source,args)})},pipe:function(stream){return this.each(stream.push),Fn$1.prototype.pipe.apply(this,arguments)},on:function(type,fn){var events=this[$events];return events?((events[type]||(events[type]=[])).push(fn),this):this},off:function off(type,fn){var events=this[$events];if(!events)return this;if(0===arguments.length)return Object.keys(events).forEach(off,this),this;var listeners=events[type];if(listeners){if(!fn)return delete events[type],this;for(var n=listeners.length;n--;)listeners[n]===fn&&listeners.splice(n,1);return this}}});var rpath=/\[?([-\w]+)(?:=(['"])([^\2]+)\2|(true|false)|((?:\d*\.)?\d+))?\]?\.?/g;function findByProperty(key,value,array){for(var l=array.length,n=-1;++n<l;)if(array[n][key]===value)return array[n]}function getRegexPath(regex,path,object){return regex.lastIndex===path.length?object:object&&"object"==typeof object?function(regex,path,object,fn){var tokens=regex.exec(path);if(!tokens)throw new Error('Fn.getPath(path, object): invalid path "'+path+'"');var key=tokens[1];return fn(regex,path,tokens[3]?findByProperty(key,tokens[2]?tokens[3]:tokens[4]?Boolean(tokens[4]):parseFloat(tokens[5]),object):object[key])}(regex,path,object,getRegexPath):void 0}function setPath(path,object,value){return rpath.lastIndex=0,function setRegexPath(regex,path,object,thing){var tokens=regex.exec(path);if(!tokens)throw new Error('Fn.getPath(path, object): invalid path "'+path+'"');var key=tokens[1];if(regex.lastIndex===path.length){if(tokens[3])throw new Error('Fn.setPath(path, object): invalid path "'+path+'"');return object[key]=thing}var value=tokens[3]?findByProperty(key,tokens[2]?tokens[3]:tokens[4]?Boolean(tokens[4]):parseFloat(tokens[5])):object[key];if(!value||"object"!=typeof value){if(value={},tokens[3]){if(!object.push)throw new Error("Not supported");value[key]=tokens[2]?tokens[3]:parseFloat(tokens[3]),object.push(value)}set(key,object,value)}return setRegexPath(regex,path,value,thing)}(rpath,path,object,value)}const Observable=window.Observable;function ObserveSource(end,object,path){this.observable=Observable(object),this.path=path,this.end=end}function ObservableStream(path,object){return new Stream$1(function(notify,stop){var source=new ObserveSource(stop,object,path);return source.unobserve=Observable.observe(object,path,function(v){source.value=void 0===v?null:v,notify("push")}),source})}ObserveSource.prototype={shift:function(){var value=this.value;return this.value=void 0,value},push:function(){setPath(this.path,this.observable,arguments[arguments.length-1])},stop:function(){this.unobserve(),this.end()},unobserve:noop$1};var _is=Object.is||function(a,b){return a===b};var parse$1=curry$1(function(regex,fns,output,string){var data;"string"!=typeof string&&(string=(data=string).input.slice(data.index+data[0].length));var result=regex.exec(string);if(!result)throw new Error('Sparky: unable to parse "'+string+'" with '+regex);return output=function(fns,object,data){for(var n=-1;++n<data.length;)void 0!==data[n]&&fns[n]&&(object=fns[n](object,data[n],data));return object}(fns,output,result),fns.close&&(output=fns.close(output,result)),data&&(data.index+=result.index+result[0].length),output});const N=Number.prototype,isNaN=Number.isNaN;const A$3=Array.prototype;function map(fn,object){return object&&object.map?object.map(fn):A$3.map.call(object,fn)}function filter(fn,object){return object.filter?object.filter(fn):A$3.filter.call(object,fn)}function insert(fn,array,object){for(var n=-1,l=array.length,value=fn(object);++n<l&&fn(array[n])<=value;);A$3.splice.call(array,n,0,object)}const assign$2=Object.assign;function last(array){if("number"==typeof array.length)return array[array.length-1]}function mod(d,n){var value=n%d;return value<0?value+d:value}function todB(n){return 20*Math.log10(n)}function toLevel(n){return Math.pow(2,n/6)}function toRad(n){return n/angleFactor}function toDeg(n){return n*angleFactor}function toPolar(cartesian){var x=cartesian[0],y=cartesian[1];return[0===x?Math.abs(y):0===y?Math.abs(x):Math.sqrt(x*x+y*y),Math.atan2(x,y)]}function toCartesian(polar){var d=polar[0],a=polar[1];return[Math.sin(a)*d,Math.cos(a)*d]}function createOrdinals(ordinals){for(var array=[],n=0;n++<31;)array[n]=ordinals[n]||ordinals.n;return array}var langs={en:{days:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),months:"January February March April May June July August September October November December".split(" "),ordinals:createOrdinals({n:"th",1:"st",2:"nd",3:"rd",21:"st",22:"nd",23:"rd",31:"st"})},fr:{days:"dimanche lundi mardi mercredi jeudi vendredi samedi".split(" "),months:"janvier février mars avril mai juin juillet août septembre octobre novembre décembre".split(" "),ordinals:createOrdinals({n:"ième",1:"er"})},de:{days:"Sonntag Montag Dienstag Mittwoch Donnerstag Freitag Samstag".split(" "),months:"Januar Februar März April Mai Juni Juli Oktober September Oktober November Dezember".split(" "),ordinals:createOrdinals({n:"er"})},it:{days:"domenica lunedì martedì mercoledì giovedì venerdì sabato".split(" "),months:"gennaio febbraio marzo aprile maggio giugno luglio agosto settembre ottobre novembre dicembre".split(" "),ordinals:createOrdinals({n:"o"})}},rdate=/^(-?\d{4})(?:-(0[1-9]|1[012])(?:-(0[1-9]|[12]\d|3[01])(?:T([01]\d|2[0-3])(?::([0-5]\d)(?::([0-5]\d)(?:.(\d+))?)?)?)?)?)?([+-]([01]\d|2[0-3]):?([0-5]\d)?|Z)?$/,rdatediff=/^([+-])?(\d{2,})(?:-(\d{2,})(?:-(\d{2,}))?)?(?:([T-])|$)/,parseDate=overload(toType,{number:secondsToDate,string:exec(rdate,function(match,year,month,day,hour,minute,second,ms,zone,zoneHour,zoneMinute){month=parseInt(month,10)-1;var date=new Date(ms?Date.UTC(year,month,day,hour,minute,second,ms):second?Date.UTC(year,month,day,hour,minute,second):minute?Date.UTC(year,month,day,hour,minute):hour?Date.UTC(year,month,day,hour):day?Date.UTC(year,month,day):month?Date.UTC(year,month):Date.UTC(year));zone&&("00"!==zoneHour||"00"!==zoneMinute&&void 0!==zoneMinute)&&function(sign,hour,minute,date){"+"===sign?(date.setUTCHours(date.getUTCHours()-parseInt(hour,10)),minute&&date.setUTCMinutes(date.getUTCMinutes()-parseInt(minute,10))):"-"===sign&&(date.setUTCHours(date.getUTCHours()+parseInt(hour,10)),minute&&date.setUTCMinutes(date.getUTCMinutes()+parseInt(minute,10)))}(zone[0],zoneHour,zoneMinute,date);return date}),object:function(date){return function(date){return"Date"===(object=date,O.toString.apply(object).slice(8,-1))&&!Number.isNaN(date.getTime());var object}(date)?date:void 0},default:noop$1});overload(toType,{number:secondsToDate,string:exec(rdate,function(year,month,day,hour,minute,second,ms,zone){if(zone)throw new Error('Time.parseDateLocal() will not parse a string with a time zone "'+zone+'".');return month=parseInt(month,10)-1,ms?new Date(year,month,day,hour,minute,second,ms):second?new Date(year,month,day,hour,minute,second):minute?new Date(year,month,day,hour,minute):hour?new Date(year,month,day,hour):day?new Date(year,month,day):month?new Date(year,month):new Date(year)}),object:function(date){return date instanceof Date?date:void 0},default:noop$1});function exec(regex,fn,error){return function(string){var parts=regex.exec(string);if(!parts&&error)throw error;return parts?fn.apply(null,parts):void 0}}function secondsToDate(n){return new Date(secondsToMilliseconds(n))}var dateFormatters={YYYY:function(date){return("000"+date.getFullYear()).slice(-4)},YY:function(date){return("0"+date.getFullYear()%100).slice(-2)},MM:function(date){return("0"+(date.getMonth()+1)).slice(-2)},MMM:function(date,lang){return this.MMMM(date,lang).slice(0,3)},MMMM:function(date,lang){return langs[lang||Time.lang].months[date.getMonth()]},D:function(date){return""+date.getDate()},DD:function(date){return("0"+date.getDate()).slice(-2)},ddd:function(date,lang){return this.dddd(date,lang).slice(0,3)},dddd:function(date,lang){return langs[lang||Time.lang].days[date.getDay()]},hh:function(date){return("0"+date.getHours()).slice(-2)},mm:function(date){return("0"+date.getMinutes()).slice(-2)},ss:function(date){return("0"+date.getSeconds()).slice(-2)},sss:function(date){return(date.getSeconds()+date.getMilliseconds()/1e3+"").replace(/^\d\.|^\d$/,function($0){return"0"+$0})},ms:function(date){return""+date.getMilliseconds()},am:function(date){return date.getHours()<12?"am":"pm"},zz:function(date){return(date.getTimezoneOffset()<0?"+":"-")+("0"+Math.round(100*Math.abs(date.getTimezoneOffset())/60)).slice(-4)},th:function(date,lang){return langs[lang||Time.lang].ordinals[date.getDate()]},n:function(date){return+date},ZZ:function(date){return 60*-date.getTimezoneOffset()}},componentFormatters={YYYY:function(data){return data.year},YY:function(data){return("0"+data.year).slice(-2)},MM:function(data){return data.month},MMM:function(data,lang){return this.MMMM(data,lang).slice(0,3)},MMMM:function(data,lang){return langs[lang].months[data.month-1]},D:function(data){return parseInt(data.day,10)+""},DD:function(data){return data.day},ddd:function(data){return data.weekday.slice(0,3)},dddd:function(data,lang){return data.weekday},hh:function(data){return data.hour},mm:function(data){return data.minute},ss:function(data){return data.second}},componentKeys={"en-US":["weekday","month","day","year","hour","minute","second"],default:["weekday","day","month","year","hour","minute","second"]},options={timeZone:"UTC",formatMatcher:"basic",hour12:!1,weekday:"long",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"},rtoken=/([YZMDdhmswz]{2,4}|\+-)/g,rusdate=/\w{3,}|\d+/g,rdatejson=/^"(-?\d{4,}-\d\d-\d\d)/;function toLocaleComponents(timezone,locale,date){var localedate=function(timezone,locale,date){return options.timeZone=timezone||"UTC",date.toLocaleString(locale,options)}(timezone,locale,date),components={},keys=componentKeys[locale]||componentKeys.default,i=0;return function matchEach(regex,fn,text){var match=regex.exec(text);return match?(fn.apply(null,match),matchEach(regex,fn,text)):void 0}(rusdate,function(value){components[keys[i++]]=value},localedate),components}var days={mon:1,tue:2,wed:3,thu:4,fri:5,sat:6,sun:0},dayMap=[6,0,1,2,3,4,5];function cloneDate(date){return new Date(+date)}function _addDate(duration,date){date=cloneDate(date);var tokens=rdatediff.exec(duration),sign=1;if(tokens){if(function(sign,yy,mm,dd,date){if(date.setUTCFullYear(date.getUTCFullYear()+sign*parseInt(yy,10)),mm){var month=date.getUTCMonth(),monthDiff=sign*parseInt(mm,10),monthTarget=mod(12,month+monthDiff);for(date.setUTCMonth(month+monthDiff);date.getUTCMonth()>monthTarget;)date.setUTCDate(0);dd&&date.setUTCDate(date.getUTCDate()+sign*parseInt(dd,10))}}(sign="-"===tokens[1]?-1:1,tokens[2],tokens[3],tokens[4],date),!tokens[5])return date;if("-"===(duration=duration.slice(tokens[0].length))[0])return date}var time=parseTimeDiff(duration);if(void 0!==time)return date.setTime(date.getTime()+sign*time*1e3),date}function diff$1(t,d1,d2){var y1=d1.getUTCFullYear(),m1=d1.getUTCMonth(),y2=d2.getUTCFullYear(),m2=d2.getUTCMonth();return y1===y2&&m1===m2?t+d2.getUTCDate()-d1.getUTCDate():(t+=d2.getUTCDate(),d2.setUTCDate(0),diff$1(t,d1,d2))}function _diffDateDays(date1,date2){var d1=parseDate(date1),d2=parseDate(date2);return d2>d1?diff$1(0,d1,d2===date2||d1===d2?cloneDate(d2):d2):-1*diff$1(0,d2,d1===date1||d2===d1?cloneDate(d1):d1)}function floorDateByGrain(grain,date){var diff;return"ms"===grain?date:(date.setUTCMilliseconds(0),"second"===grain?date:(date.setUTCSeconds(0),"minute"===grain?date:(date.setUTCMinutes(0),"hour"===grain?date:(date.setUTCHours(0),"day"===grain?date:"week"===grain?(date.setDate(date.getDate()-function(date){return dayMap[date.getDay()]}(date)),date):"fortnight"===grain?(diff=mod(14,_diffDateDays(floorDateByDay(1,new Date),date)),date.setUTCDate(date.getUTCDate()-diff),date):(date.setUTCDate(1),"month"===grain?date:(date.setUTCMonth(0),"year"===grain?date:(date.setUTCFullYear(0),date)))))))}function floorDateByDay(day,date){var currentDay=date.getUTCDay();if(day===currentDay)return date;var diff=currentDay-day;return diff<0&&(diff+=7),_addDate("-0000-00-0"+diff,date)}const addDate=curry$1(function(diff,date){return _addDate(diff,parseDate(date))}),formatDate=(curry$1(_diffDateDays),curry$1(function(token,date){return function(grain,date){date=cloneDate(date);var day="number"==typeof grain?grain:days[grain];return isDefined(day)?floorDateByDay(day,date):floorDateByGrain(grain,date)}(token,parseDate(date))}),curry$1(function(string,timezone,locale,date){return"ISO"===string?function(date){return rdatejson.exec(JSON.stringify(parseDate(date)))[1]}(parseDate(date)):"local"===timezone?function(string,locale,date){var formatters=dateFormatters,lang=locale.slice(0,2);return string.replace(rtoken,function($0){return formatters[$0]?formatters[$0](date,lang):$0})}(string,locale,date):function(string,timezone,locale,date){var lang=locale?locale.slice(0,2):document.documentElement.lang,data=toLocaleComponents(timezone,locale="en"===locale?"en-US":locale||"en-US",date),formats=componentFormatters;return string.replace(rtoken,function($0){return formats[$0]?formats[$0](data,lang):$0})}(string,timezone,locale,parseDate(date))}));var precision=9;function secondsToMilliseconds(n){return 1e3*n}function secondsToHours(n){return n/3600}function prefix(n){return n>=10?"":"0"}var parseTime=overload(toType,{number:id,string:exec(/^([+-])?(\d{2,}):([0-5]\d)(?::((?:[0-5]\d|60)(?:.\d+)?))?$/,createTime),default:function(object){throw new Error("parseTime() does not accept objects of type "+typeof object)}}),parseTimeDiff=overload(toType,{number:id,string:exec(/^([+-])?(\d{2,}):(\d{2,})(?::(\d{2,}(?:.\d+)?))?$/,createTime),default:function(object){throw new Error("parseTime() does not accept objects of type "+typeof object)}}),_floorTime=function(map){return function(key){var fn=map[key]||map.default;return fn&&fn.apply(this,rest(1,arguments))}}({week:function(time){return time-mod(604800,time)},day:function(time){return time-mod(86400,time)},hour:function(time){return time-mod(3600,time)},minute:function(time){return time-mod(60,time)},second:function(time){return time-mod(1,time)}}),timeFormatters={"+-":function(time){return time<0?"-":""},www:function(time){time=time<0?-time:time;var weeks=Math.floor(time/604800);return prefix(weeks)+weeks},dd:function(time){time=time<0?-time:time;var days=Math.floor(time/86400);return prefix(days)+days},hhh:function(time){time=time<0?-time:time;var hours=Math.floor(secondsToHours(time));return prefix(hours)+hours},hh:function(time){time=time<0?-time:time;var hours=Math.floor(secondsToHours(time%86400));return prefix(hours)+hours},mm:function(time){time=time<0?-time:time;var minutes=Math.floor(time%3600/60);return prefix(minutes)+minutes},ss:function(time){time=time<0?-time:time;var seconds=Math.floor(time%60);return prefix(seconds)+seconds},sss:function(time){var seconds=(time=time<0?-time:time)%60;return prefix(seconds)+toMaxDecimals(precision,seconds)},ms:function(time){time=time<0?-time:time;var ms=Math.floor(secondsToMilliseconds(time%1));return ms>=100?ms:ms>=10?"0"+ms:"00"+ms}};function createTime(match,sign,hh,mm,sss){var time=3600*parseInt(hh,10)+(mm?function(n){return 60*n}(parseInt(mm,10))+(sss?parseFloat(sss,10):0):0);return"-"===sign?-time:time}function toMaxDecimals(precision,n){return n.toFixed(precision).replace(/\.?0+$/,"")}const formatTime=curry$1(function(string,time){return"ISO"===string?function(time){var sign=time<0?"-":"";time<0&&(time=-time);var hours=Math.floor(time/3600),hh=prefix(hours)+hours;if(0==(time%=3600))return sign+hh+":00";var minutes=Math.floor(time/60),mm=prefix(minutes)+minutes;return 0==(time%=60)?sign+hh+":"+mm:sign+hh+":"+mm+":"+(prefix(time)+toMaxDecimals(precision,time))}(parseTime(time)):function(string,time){return string.replace(rtoken,function($0){return timeFormatters[$0]?timeFormatters[$0](time):$0})}(string,parseTime(time))}),addTime=curry$1(function(time1,time2){return parseTime(time2)+parseTimeDiff(time1)}),subTime=curry$1(function(time1,time2){return parseTime(time2)-parseTimeDiff(time1)});curry$1(function(time1,time2){return parseTime(time1)-parseTime(time2)}),curry$1(function(token,time){return _floorTime(token,parseTime(time))});window.console&&window.console.log&&window.console.log("Fn          - https://github.com/stephband/fn");const toFloat=parseFloat,equals$1=(curry$1(function(a,b){return!(!a||!b)}),curry$1(function(a,b){return a||b}),curry$1(function(a,b){return(a||b)&&!!a!=!!b}),curry$1(Object.assign,!0,2),curry$1(Object.defineProperties,!0,2),curry$1(function equals(a,b){if(a===b)return!0;if(null===a||null===b||"object"!=typeof a||"object"!=typeof b)return!1;var akeys=Object.keys(a),bkeys=Object.keys(b);if(akeys.length!==bkeys.length)return!1;for(var n=akeys.length;n--;)if(!equals(a[akeys[n]],b[akeys[n]]))return!1;return!0},!0)),get$1=curry$1(function(key,object){const value=object[key];return null===value?void 0:value},!0),is=curry$1(_is,!0),invoke$1=curry$1(function(name,values,object){return object[name].apply(object,values)},!0),set$1=(curry$1(parse$1),curry$1(set,!0)),toFixed$1=curry$1(function(n,value){if(isNaN(value))throw new Error("Fn.toFixed does not accept NaN.");return N.toFixed.call(value,n)}),getPath$1=curry$1(function(path,object){return rpath.lastIndex=0,getRegexPath(rpath,path,object)},!0),setPath$1=curry$1(setPath,!0),contains$1=(curry$1(function(array2,array1){return Array.isArray(array1)?array1.concat(Array.isArray(array2)?array2:toArray(array2)):array1.concat?array1.concat(array2):toArray(array1).concat(Array.isArray(array2)?array2:toArray(array2))},!0),curry$1(function(value,object){return object.includes?object.includes(value):object.contains?object.contains(value):A$3.includes?A$3.includes.call(object,value):-1!==A$3.indexOf.call(object,value)},!0)),remove$2=(curry$1(filter,!0),curry$1(function(fn,object){return A$3.find.call(object,fn)},!0),curry$1(insert,!0),curry$1(map,!0),curry$1(function(fn,seed,object){return object.reduce?object.reduce(fn,seed):A$3.reduce.call(object,fn,seed)},!0),curry$1(function(array,value){array.remove&&array.remove(value);var i=array.indexOf(value);-1!==i&&array.splice(i,1)},!0)),append$1=(curry$1(rest,!0),curry$1(function(n,m,object){return object.slice?object.slice(n,m):A$3.slice.call(object,n,m)},!0,3),curry$1(function(i,object){if(object.slice)return object.slice(0,i);if(object.take)return object.take(i);for(var a=[],n=i;n--;)a[n]=object[n];return a},!0),curry$1(function(fn,target,array){return array.reduce(function(target,obj2){var obj1=target.find(compose$1(is(fn(obj2)),fn));return obj1?assign$2(obj1,obj2):insert(fn,target,obj2),target},target)},!0),curry$1(function(array,object){var values=toArray$1(array);return filter(function(value){var i=values.indexOf(value);return-1===i||(values.splice(i,1),!1)},object).concat(values)},!0),curry$1(function(array,object){var values=toArray$1(array);return filter(function(value){var i=values.indexOf(value);return-1!==i&&(values.splice(i,1),!0)},object)},!0),curry$1(function(array,object){var values=toArray(array);return map(function(value){var i=values.indexOf(value);return i>-1&&values.splice(i,1),value},object).concat(values)},!0),curry$1(function(string1,string2){return""+string2+string1})),prepend$2=curry$1(function(string1,string2){return""+string1+string2}),prepad$1=curry$1(function(chars,n,value){for(var string=value+"",i=-1,pre="";pre.length<n-string.length;)pre+=chars[++i%chars.length];return(string=pre+string).slice(string.length-n)}),postpad$1=curry$1(function(chars,n,value){for(var string=value+"";string.length<n;)string+=chars;return string.slice(0,n)}),multiply$1=(curry$1(function(a,b){return b+a}),curry$1(function(a,b){return b*a})),min$1=curry$1(function(a,b){return a>b?b:a}),max$1=curry$1(function(a,b){return a<b?b:a}),mod$1=curry$1(mod),pow$1=curry$1(function(n,x){return Math.pow(x,n)}),exp$1=curry$1(function(n,x){return Math.pow(n,x)}),log$1=curry$1(function(n,x){return Math.log(x)/Math.log(n)}),root$1=curry$1(function(n,x){return Math.pow(x,1/n)}),limit$1=curry$1(function(min,max,n){return n>max?max:n<min?min:n}),normalise$1=(curry$1(function(min,max,n){return(n<min?max:min)+(n-min)%(max-min)}),curry$1(function(min,max,n){return(n-min)/(max-min)})),denormalise$1=curry$1(function(min,max,n){return n*(max-min)+min});var Node=window.Node,SVGElement=window.SVGElement,CustomEvent=window.CustomEvent,assign$5=Object.assign,define$1=Object.defineProperties,A$4=Array.prototype,rspaces=/\s+/,rpx=/px$/,features=define$1({events:define$1({},{fullscreenchange:{get:cache(function(){return"fullscreenElement"in document?"fullscreenchange":"webkitFullscreenElement"in document?"webkitfullscreenchange":"mozFullScreenElement"in document?"mozfullscreenchange":"msFullscreenElement"in document?"MSFullscreenChange":"fullscreenchange"}),enumerable:!0},transitionend:{get:cache(function(){var prefixed=prefix$1("transition");return prefixed&&{KhtmlTransition:!1,OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"}[prefixed]}),enumerable:!0}})},{inputEventsWhileDisabled:{get:cache(function(){var input=document.createElement("input"),testEvent=Event("featuretest"),result=!1;return appendChild(document.body,input),input.disabled=!0,input.addEventListener("featuretest",function(e){result=!0}),input.dispatchEvent(testEvent),removeNode(input),result}),enumerable:!0},template:{get:cache(function(){return"content"in document.createElement("template")}),enumerable:!0},textareaPlaceholderSet:{get:cache(function(){var node=document.createElement("textarea");return node.setAttribute("placeholder","---"),""===node.innerHTML}),enumerable:!0},transition:{get:cache(function(){return prefix$1("transition")||!1}),enumerable:!0},fullscreen:{get:cache(function(){var node=document.createElement("div");return!!(node.requestFullscreen||node.webkitRequestFullscreen||node.mozRequestFullScreen||node.msRequestFullscreen)}),enumerable:!0},transitionend:{get:function(){return console.warn("dom.features.transitionend deprecated in favour of dom.features.events.transitionend."),features.events.transitionend},enumerable:!0}});function toArray$2(object){var i,array=[],l=array.length=object.length;for(i=0;i<l;i++)array[i]=object[i];return array}function TokenList(node,get,set){this.node=node,this.get=get,this.set=set}TokenList.prototype={add:function(){for(var n=arguments.length,tokens=this.get(this.node),array=tokens?tokens.trim().split(rspaces):[];n--;)-1===array.indexOf(arguments[n])&&array.push(arguments[n]);this.set(this.node,array.join(" "))},remove:function(){for(var i,n=arguments.length,tokens=this.get(this.node),array=tokens?tokens.trim().split(rspaces):[];n--;)-1!==(i=array.indexOf(arguments[n]))&&array.splice(i,1);this.set(this.node,array.join(" "))},contains:function(string){var tokens=this.get(this.node);return-1!==(tokens?tokens.trim().split(rspaces):[]).indexOf(string)}};var testDiv=document.createElement("div"),types={1:"element",3:"text",8:"comment",9:"document",10:"doctype",11:"fragment"},constructors={text:function(text){return document.createTextNode(text||"")},comment:function(text){return document.createComment(text||"")},fragment:function(html){var fragment=document.createDocumentFragment();return html&&(testDiv.innerHTML=html,append$2(fragment,testDiv.childNodes),testDiv.innerHTML=""),fragment}};function assignAttributes(node,attributes){for(var names=Object.keys(attributes),n=names.length;n--;)names[n]in node?node[names[n]]=attributes[names[n]]:node.setAttribute(names[n],attributes[names[n]])}function create$1(name){if(constructors[name])return constructors[name](arguments[1]);var attributes,node=document.createElement(name);return"string"==typeof arguments[1]?(node.innerHTML=arguments[1],attributes=arguments[2]):attributes=arguments[1],attributes&&assignAttributes(node,attributes),node}["circle","ellipse","g","line","rect","use","path","polygon","polyline","svg"].forEach(function(tag){constructors[tag]=function(attributes){var node=document.createElementNS("http://www.w3.org/2000/svg",tag);return attributes&&function(node,attributes){var names=Object.keys(attributes),n=names.length;for(;n--;)node.setAttributeNS(null,names[n],attributes[names[n]])}(node,attributes),node}});var clone=features.textareaPlaceholderSet?function(node){return node.cloneNode(!0)}:function(node){var clones,clone=node.cloneNode(!0),textareas=dom.query("textarea",node),n=textareas.length;if(n)for(clones=dom.query("textarea",clone);n--;)clones[n].value=textareas[n].value;return clone};function tag(node){return node.tagName&&node.tagName.toLowerCase()}function attribute(name,node){return node.getAttribute&&node.getAttribute(name)||void 0}function setClass(node,classes){node instanceof SVGElement?node.setAttribute("class",classes):node.className=classes}function classes(node){return node.classList||new TokenList(node,dom.attribute("class"),setClass)}function query(selector,node){return toArray$2((node=node||document).querySelectorAll(selector))}function matches(selector,node){return node.matches?node.matches(selector):node.matchesSelector?node.matchesSelector(selector):node.webkitMatchesSelector?node.webkitMatchesSelector(selector):node.mozMatchesSelector?node.mozMatchesSelector(selector):node.msMatchesSelector?node.msMatchesSelector(selector):node.oMatchesSelector?node.oMatchesSelector(selector):tag(node)===selector}function closest(selector,node){var root=arguments[2];if(node&&node!==document&&node!==root&&11!==node.nodeType)return matches(selector,node=node.correspondingUseElement||node)?node:closest(selector,node.parentNode,root)}function appendChild(target,node){return target.appendChild(node),target}function append$2(target,node){return node instanceof Node||node instanceof SVGElement?(appendChild(target,node),node):node.length?((node.reduce?node:A$4.slice.call(node)).reduce(appendChild,target),node):void 0}function removeNode(node){node.parentNode&&node.parentNode.removeChild(node)}function remove$3(node){node instanceof Node||node instanceof SVGElement?removeNode(node):A$4.forEach.call(node,removeNode)}function before(target,node){target.parentNode&&target.parentNode.insertBefore(node,target)}var styleParsers={"transform:translateX":function(node){var matrix=style("transform",node);if(!matrix||"none"===matrix)return 0;var values=valuesFromCssFn(matrix);return parseFloat(values[4])},"transform:translateY":function(node){var matrix=style("transform",node);if(!matrix||"none"===matrix)return 0;var values=valuesFromCssFn(matrix);return parseFloat(values[5])},"transform:scale":function(node){var matrix=style("transform",node);if(!matrix||"none"===matrix)return 0;var values=valuesFromCssFn(matrix),a=parseFloat(values[0]),b=parseFloat(values[1]);return Math.sqrt(a*a+b*b)},"transform:rotate":function(node){var matrix=style("transform",node);if(!matrix||"none"===matrix)return 0;var values=valuesFromCssFn(matrix),a=parseFloat(values[0]),b=parseFloat(values[1]);return Math.atan2(b,a)}},prefix$1=function(prefixes){var node=document.createElement("div"),cache$$1={};return function(prop){return cache$$1[prop]||(cache$$1[prop]=function(prop){if(prop in node.style)return prop;for(var prefixProp,upper=prop.charAt(0).toUpperCase()+prop.slice(1),l=prefixes.length;l--;)if((prefixProp=prefixes[l]+upper)in node.style)return prefixProp;return!1}(prop))}}(["Khtml","O","Moz","Webkit","ms"]);function valuesFromCssFn(string){return string.split("(")[1].split(")")[0].split(/\s*,\s*/)}function style(name,node){return window.getComputedStyle?window.getComputedStyle(node,null).getPropertyValue(name):0}function box(node){return node===window?{left:0,top:0,right:window.innerWidth,bottom:window.innerHeight,width:window.innerWidth,height:window.innerHeight}:node.getClientRects()[0]}var keyCodes={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",27:"escape",32:"space",33:"pageup",34:"pagedown",35:"pageright",36:"pageleft",37:"left",38:"up",39:"right",40:"down",46:"delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"cmd",93:"cmd",186:";",187:"=",188:",",189:"-",190:".",191:"/",219:"[",220:"\\",221:"]",222:"'",224:"cmd"},eventOptions={bubbles:!0},eventsSymbol=Symbol("events"),untrapFocus=noop$1;function Event(type,properties){var options=assign$5({},eventOptions,properties),event=new CustomEvent(type,options);return properties&&(delete properties.detail,assign$5(event,properties)),event}function on(node,type,fn,data){var options;"object"==typeof type&&(type=(options=type).type);for(var types=type.split(rspaces),events=node[eventsSymbol]||(node[eventsSymbol]={}),handler=data?function(fn){var args$$1=A$4.slice.call(arguments,1);return function(){A$4.push.apply(arguments,args$$1),fn.apply(null,arguments)}}(fn,data):fn,n=-1;++n<types.length;)(events[type=types[n]]||(events[type]=[])).push([fn,handler]),node.addEventListener(type,handler,options);return node}function off(node,type,fn){"object"==typeof type&&(type=type.type);var handlers,i,types=type.split(rspaces),events=node[eventsSymbol];if(!events)return node;for(var n=-1;n++<types.length;)if(handlers=events[type=types[n]])for(i=handlers.length;i--;)handlers[i][0]===fn&&(node.removeEventListener(type,handlers[i][1]),handlers.splice(i,1));return node}function trigger(node,type,properties){var event=Event(type,properties);node.dispatchEvent(event)}function end(e,fn){off(e.currentTarget,features.events.transitionend,end),fn(e.timeStamp)}function prefixType(type){return features.events[type]||type}function event(type,node){var options;"object"==typeof type&&(type=(options=type).type);var types=type.split(rspaces).map(prefixType);return new Stream$1(function(notify,stop){var buffer=[];function update(value){buffer.push(value),notify("push")}return types.forEach(function(type){node.addEventListener(type,update,options)}),{shift:function(){return buffer.shift()},stop:function(){types.forEach(function(type){node.removeEventListener(type,update)}),stop(buffer.length)}}})}function trapFocus(node){untrapFocus();var focusNode=document.activeElement||document.body;function resetFocus(){var focusable=dom.query("[tabindex], a, input, textarea, button",node)[0];focusable&&focusable.focus()}function preventFocus(e){node.contains(e.target)||(resetFocus(),e.preventDefault(),e.stopPropagation())}return document.addEventListener("focus",preventFocus,!0),requestTick(resetFocus),untrapFocus=function(){untrapFocus=noop$1,document.removeEventListener("focus",preventFocus,!0),requestTick(function(){focusNode.focus()})}}var mimetypes={xml:"application/xml",html:"text/html",svg:"image/svg+xml"};function fragmentFromChildren(node){if(node.domFragmentFromChildren)return node.domFragmentFromChildren;var fragment=create$1("fragment");return node.domFragmentFromChildren=fragment,append$2(fragment,node.childNodes),fragment}function fragmentFromHTML(html,tag){var node=document.createElement(tag||"div");return node.innerHTML=html,fragmentFromChildren(node)}function fragmentFromTemplate(node){return node.content||fragmentFromChildren(node)}var pre,text,fontSize,escape=(pre=document.createElement("pre"),text=document.createTextNode(""),pre.appendChild(text),function(value){return text.textContent=value,pre.innerHTML}),runit=/(\d*\.?\d+)(r?em|vw|vh)/,units={em:function(n){return getFontSize()*n},rem:function(n){return getFontSize()*n},vw:function(n){return window.innerWidth*n/100},vh:function(n){return window.innerHeight*n/100}},toPx=overload(toType,{number:id,string:function(string){var data=runit.exec(string);if(data)return units[data[2]](parseFloat(data[1]));throw new Error('dom: "'+string+'" cannot be parsed as rem, em, vw or vh units.')}});function getFontSize(){return fontSize||(fontSize=parseFloat(style("font-size",document.documentElement),10))}function transition(duration,fn){var t0=performance.now();var id$$1=requestAnimationFrame(function frame(t1){var progress=(t1-t0)/(1e3*duration);progress<1?(progress>0&&fn(progress),id$$1=requestAnimationFrame(frame)):fn(1)});return function(){cancelAnimationFrame(id$$1)}}function animateScroll(coords){var x,y,ease=pow$1(2);"number"==typeof coords?(x=!1,y=coords):(x=coords[0],y=coords[1]);var denormaliseX=!1!==x&&denormalise$1(dom.view.scrollLeft,x),denormaliseY=denormalise$1(dom.view.scrollTop,y);return transition(.6,pipe(ease,function(progress){!1!==x&&(dom.view.scrollLeft=denormaliseX(progress)),dom.view.scrollTop=denormaliseY(progress)}))}function dom(selector){return query(selector,document)}var ready=new Promise(function(accept,reject){function handle(){document.removeEventListener("DOMContentLoaded",handle),window.removeEventListener("load",handle),accept()}document.addEventListener("DOMContentLoaded",handle),window.addEventListener("load",handle)});assign$5(dom,{ready:ready.then.bind(ready),now:function(){return window.performance.now()/1e3},get:function(id$$1){return document.getElementById(id$$1)||void 0},find:curry$1(function(selector,node){return node.querySelector(selector)},!0),query:curry$1(query,!0),closest:curry$1(closest,!0),contains:curry$1(function contains$2(child,node){return node.contains?node.contains(child):!!child.parentNode&&(child.parentNode===node||contains$2(child.parentNode,node))},!0),matches:curry$1(matches,!0),children:function(node){return toArray$2(node.children||node.querySelectorAll("*"))},next:function(node){return node.nextElementSibling||void 0},previous:function(node){return node.previousElementSibling||void 0},assign:curry$1(assignAttributes,!0),create:create$1,clone:clone,identify:function(node){var id$$1=node.id;if(!id$$1){do{id$$1=Math.ceil(1e5*Math.random())}while(document.getElementById(id$$1));node.id=id$$1}return id$$1},append:curry$1(append$2,!0),before:curry$1(before,!0),after:curry$1(function(target,node){target.parentNode&&target.parentNode.insertBefore(node,target.nextSibling)},!0),replace:curry$1(function(target,node){return before(target,node),remove$3(target),target},!0),empty:function(node){for(;node.lastChild;)node.removeChild(node.lastChild)},remove:remove$3,validate:function(node){return!node.checkValidity||node.checkValidity()},fullscreen:function(node){return node.requestFullscreen?node.requestFullscreen():node.webkitRequestFullscreen?node.webkitRequestFullscreen():node.mozRequestFullScreen?node.mozRequestFullScreen():node.msRequestFullscreen?node.msRequestFullscreen():void 0},isElementNode:function(node){return 1===node.nodeType},isTextNode:function(node){return 3===node.nodeType},isCommentNode:function(node){return 8===node.nodeType},isFragmentNode:function(node){return 11===node.nodeType},isInternalLink:function(node){var str,location=window.location;return node.hostname&&location.hostname===node.hostname&&location.pathname===(str=node.pathname,(/^\//.test(str)?"":"/")+str)},isValid:function(node){return!node.validity||node.validity.valid},type:function(node){return types[node.nodeType]},tag:tag,attribute:curry$1(attribute,!0),classes:classes,addClass:curry$1(function(string,node){classes(node).add(string)},!0),removeClass:curry$1(function(string,node){classes(node).remove(string)},!0),flashClass:curry$1(function(string,node){var list=classes(node);list.add(string),requestAnimationFrame(function(){list.remove(string)})},!0),box:box,bounds:function(node){return node.getBoundingClientRect()},offset:curry$1(function(node1,node2){var box1=box(node1),box2=box(node2);return[box2.left-box1.left,box2.top-box1.top]},!0),prefix:prefix$1,style:curry$1(function(name,node){if(styleParsers[name])return styleParsers[name](node);var value=style(name,node);return"string"==typeof value&&rpx.test(value)?parseFloat(value):value},!0),toPx:toPx,toRem:function(n){return toPx(n)/getFontSize()+"rem"},toVw:function(n){return 100*toPx(n)/window.innerWidth+"vw"},toVh:function(n){return 100*toPx(n)/window.innerHeight+"vh"},fragmentFromTemplate:fragmentFromTemplate,fragmentFromChildren:fragmentFromChildren,fragmentFromHTML:fragmentFromHTML,fragmentFromId:function(id$$1){var node=document.getElementById(id$$1);if(!node)throw new Error('DOM: element id="'+id$$1+'" is not in the DOM.');var t=tag(node);return"template"!==t||features.template||remove$3(node),"template"===t?fragmentFromTemplate(node):"script"===t?fragmentFromHTML(node.innerHTML,attribute("data-parent-tag",node)):fragmentFromChildren(node)},escape:escape,parse:curry$1(function(type,string){if(string){var xml,mimetype=mimetypes[type];try{xml=(new window.DOMParser).parseFromString(string,mimetype)}catch(e){xml=void 0}if(!xml||xml.getElementsByTagName("parsererror").length)throw new Error("dom: Invalid XML: "+string);return xml}}),Event:Event,delegate:function(selector,fn){return function(e){var node=closest(selector,e.target,e.currentTarget);node&&(e.delegateTarget=node,fn(e,node),e.delegateTarget=void 0)}},isPrimaryButton:function(e){return 1===e.which&&!e.ctrlKey&&!e.altKey&&!e.shiftKey},isTargetEvent:function(e){return e.target===e.currentTarget},preventDefault:function(e){e.preventDefault()},toKey:function(e){return keyCodes[e.keyCode]},trapFocus:trapFocus,trap:deprecate(trapFocus,"dom.trap() is now dom.trapFocus()"),trigger:curry$1(function(type,node){return trigger(node,type),node},!0),events:assign$5(curry$1(event,!0),{on:on,once:function(node,types,fn,data){on(node,types,function once(){off(node,types,once),fn.apply(null,arguments)},data)},off:off,trigger:trigger}),on:deprecate(curry$1(event,!0),"dom.on() is now dom.events()"),event:deprecate(curry$1(event,!0),"Deprecated dom.event() – now dom.events()"),transition:curry$1(transition,!0),schedule:deprecate(transition,"dom: .schedule() is now .transition()"),animate:curry$1(function(duration,transform,name,object,value){return transition(duration,pipe(transform,denormalise$1(object[name],value),set$1(name,object)))},!0),animateScroll:animateScroll,scrollTo:deprecate(animateScroll,"scrollTo(px, node) renamed to animateScroll(px)"),scrollRatio:function(node){return node.scrollTop/(node.scrollHeight-node.clientHeight)},disableScroll:function(node){var scrollLeft=(node=node||document.documentElement).scrollLeft,scrollTop=node.scrollTop;node.style.overflow="hidden",scrollTop&&(node.scrollTop=scrollTop),scrollLeft&&(node.scrollLeft=scrollLeft)},enableScroll:function(node){var scrollLeft=(node=node||document.documentElement).scrollLeft,scrollTop=node.scrollTop;node.style.overflow="",scrollTop&&(node.scrollTop=scrollTop),scrollLeft&&(node.scrollLeft=scrollLeft)},requestEvent:function(type,fn,node){if("transitionend"===type){if(!features.transition)return void fn(performance.now());type=features.events.transitionend}on(node,type,end,fn)},requestFrame:requestAnimationFrame.bind(null),requestFrameN:curry$1(deprecate(function(n,fn){!function frame(){return requestAnimationFrame(--n?frame:fn)}()},"requestFrameN() will be removed soon"),!0),features:features,safe:define$1({left:0},{right:{get:function(){return window.innerWidth},enumerable:!0,configurable:!0},top:{get:function(){return dom.style("padding-top",document.body)},enumerable:!0,configurable:!0},bottom:{get:function(){return window.innerHeight},enumerable:!0,configurable:!0}})}),define$1(dom,{root:{value:document.documentElement,enumerable:!0},head:{value:document.head,enumerable:!0},body:{get:function(){return document.body},enumerable:!0},view:{get:function(){return document.scrollingElement},enumerable:!0}}),window.console&&window.console.log&&console.log("dom         – https://github.com/stephband/dom"),window.dom=dom;const escape$1=dom.escape,toPx$1=dom.toPx,toRem$1=dom.toRem;var A$5=Array.prototype;function interpolateLinear(xs,ys,x){for(var n=-1;++n<xs.length&&xs[n]<x;);return 0===n?ys[0]:n>=xs.length?last(ys):x===xs[n]?ys[n]:(x-xs[n-1])/(xs[n]-xs[n-1])*(ys[n]-ys[n-1])+ys[n-1]}const transformers={add:{tx:curry$1(function(a,b){return b.add?b.add(a):b+a}),ix:curry$1(function(a,c){return c.add?c.add(-a):c-a})},"add-date":{tx:addDate,ix:curry$1(function(d,n){return addDate("-"+d,n)})},"add-time":{tx:addTime,ix:subTime},decibels:{tx:todB,ix:toLevel},multiply:{tx:multiply$1,ix:curry$1(function(d,n){return n/d})},degrees:{tx:toDeg,ix:toRad},radians:{tx:toRad,ix:toDeg},pow:{tx:pow$1,ix:curry$1(function(n,x){return pow$1(1/n,x)})},exp:{tx:exp$1,ix:log$1},log:{tx:log$1,ix:exp$1},int:{tx:toFixed$1(0),ix:toInt},float:{tx:toFloat,ix:toString},boolean:{tx:Boolean,ix:toString},normalise:{tx:normalise$1,ix:denormalise$1},denormalise:{tx:denormalise$1,ix:normalise$1},floatformat:{tx:toFixed$1,ix:curry$1(function(n,str){return parseFloat(str)})},"int-string":{tx:function(value){return value?value+"":""},ix:toInt},interpolate:{tx:function(point){var xs=A$5.map.call(arguments,get$1("0")),ys=A$5.map.call(arguments,get$1("1"));return function(value){return interpolateLinear(xs,ys,value)}},ix:function(point){var xs=A$5.map.call(arguments,get$1("0")),ys=A$5.map.call(arguments,get$1("1"));return function(value){return interpolateLinear(ys,xs,value)}}},cartesian:{tx:toCartesian,ix:toPolar},polar:{tx:toPolar,ix:toCartesian},deg:{tx:toDeg,ix:toRad},rad:{tx:toRad,ix:toDeg},decibels:{tx:todB,ix:toLevel},level:{tx:toLevel,ix:todB},px:{tx:toPx$1,ix:toRem$1},rem:{tx:toRem$1,ix:toPx$1}},transforms={contains:contains$1,equals:equals$1,escape:escape$1,exp:exp$1,formatdate:formatDate,formattime:formatTime,formatfloat:toFixed$1,get:getPath$1,invoke:invoke$1,is:is,last:last,limit:limit$1,log:log$1,max:max$1,min:min$1,mod:mod$1,not:function(a){return!a},percent:multiply$1(100),append:append$1,prepend:prepend$2,prepad:prepad$1,postpad:postpad$1,slugify:function(string){if("string"==typeof string)return string.trim().toLowerCase().replace(/[\W_]/g,"-")},root:root$1,type:toType,divide:curry$1(function(n,value){if("number"==typeof value)return value/n}),"find-in":curry$1(function(path,id$$1){if(isDefined(id$$1)){var array=getPath$1(path,window);return array&&array.find(compose(is(id$$1),get$1("id")))}}),floatformat:curry$1(function(n,value){return"number"==typeof value?Number.prototype.toFixed.call(value,n):isDefined(value)?console.warn("Sparky: filter floatformat: "+n+" called on non-number "+value):""}),floor:Math.floor,"greater-than":curry$1(function(value2,value1){return value1>value2}),invert:function(value){return"number"==typeof value?1/value:!value},join:curry$1(function(string,value){return A$5.join.call(value,string)}),json:JSON.stringify,"less-than":curry$1(function(value2,value1){return value1<value2}),localise:curry$1(function(digits,value){var locale=document.documentElement.lang,options={};return isDefined(digits)&&(options.minimumFractionDigits=digits,options.maximumFractionDigits=digits),value.toLocaleString?value.toLocaleString(locale,options):value}),lowercase:function(value){if("string"==typeof value)return String.prototype.toLowerCase.apply(value)},map:function(method,params){var fn;return void 0===typeof params?(fn=parse(method),function(array){return array.map(fn)}):(fn=(transformers[method]&&transformers[method].tx||transforms[method]).apply(null,params),function(array){return array&&array.map(fn)})},filter:curry$1(function(method,args$$1,array){return array&&array.map(transforms[method].apply(null,args$$1))},!0),match:curry$1(function(regex,string){return(regex="string"==typeof regex?RegExp(regex):regex).exec(string)}),matches:curry$1(function(regex,string){return!!(regex="string"==typeof regex?RegExp(regex):regex).test(string)}),pluralise:curry$1(function(str1,str2,lang,value){if("number"==typeof value)return str1=str1||"",str2=str2||"s","fr"===lang?value<2&&value>=0?str1:str2:1===value?str1:str2}),reduce:curry$1(function(name,initialValue,array){return array&&array.reduce(Fn[name],initialValue||0)},!0),replace:curry$1(function(str1,str2,value){if("string"==typeof value)return value.replace(RegExp(str1,"g"),str2)}),round:curry$1(function(n,value){return Math.round(value/n)*n}),slice:curry$1(function(i0,i1,value){return"string"==typeof value?value.slice(i0,i1):Array.prototype.slice.call(value,i0,i1)},!0),striptags:(rtag=/<(?:[^>'"]|"[^"]*"|'[^']*')*>/g,function(value){return value.replace(rtag,"")}),switch:function(value){if("boolean"==typeof value&&(value=Number(value)),"string"==typeof value&&(value=parseInt(value,10)),"number"==typeof value&&!Number.isNaN(value))return arguments[value+1]},translate:(warned={},function(value){var translations=translations;if(!translations)return warned.missingTranslations||(console.warn("Sparky: Missing lookup object Sparky.translations"),warned.missingTranslations=!0),value;var text=translations[value];return text||(warned[value]||(console.warn('Sparky: Sparky.translations contains no translation for "'+value+'"'),warned[value]=!0),value)}),truncatechars:curry$1(function(n,value){return value.length>n?value.slice(0,n)+"…":value}),uppercase:function(value){if("string"==typeof value)return String.prototype.toUpperCase.apply(value)},yesno:curry$1(function(truthy,falsy,value){return value?truthy:falsy})};var warned,rtag;const parseArrayClose=parse$1(/^\]\s*/,nothing$1),parseParams=parse$1(/^\s*(?:(-?(?:\d+|\d+\.\d+|\.\d+)(?:[eE][-+]?\d+)?)|"([^"\\]*(?:\\.[^"\\]*)*)"|'([^'\\]*(?:\\.[^'\\]*)*)'|(null)|(true)|(false)|(\[)|(\w+)\(([^)]+)\)|([^,\s\]]+))\s*(,)?\s*/,{1:function(params,value){return params.push(parseFloat(value)),params},2:function(params,value){return params.push(value),params},3:function(params,value){return params.push(value),params},4:function(params){return params.push(null),params},5:function(params){return params.push(!0),params},6:function(params){return params.push(!1),params},7:function(params,value,data){return params.push(parseParams([],data)),parseArrayClose(null,data),params},10:function(params,value){return params.push(value),params},11:function(params,value,data){return parseParams(params,data)}}),parseFn=parse$1(/^([\w-]+)\s*(:)?\s*/,{1:function(getFn,name){var fn=getFn(name);if(!fn)throw new Error("fn "+name+"() not found.");return fn},2:function(fn,value,data){return fn.apply(null,parseParams([],data))}});function getFn(name){return transformers[name]?transformers[name].tx:transforms[name]}const parsePipe1=parse$1(/^(\|)?\s*/,{1:function(array,value,data){return array.push(parseFn(getFn,data)),parsePipe1(array,data),array}});function parsePipe(string){var data="string"==typeof string?{0:"",input:string,index:0}:string,array=[];return array.push(parseFn(getFn,data)),parsePipe1(array,data),array.length>1?pipe.apply(null,array):array[0]}parse$1(/\{\[\s*([^|\s]*)\s*(\|)?\s*/,{1:function(object,path){return object.path=path,object},2:function(object,symbol,data){return object.fn=parsePipe(data),object},close:parse$1(/^\s*\]\}/,nothing$1)});const DEBUG$3=!1,now$2=dom.now,queue=new Set;var point,frame;function run(time){DEBUG$3&&((point={}).frameTime=time/1e3,point.runTime=now$2(),point.queuedFns=queue.size,point.insertedFns=0,console.groupCollapsed("frame",point.frameTime.toFixed(3))),frame=!0,queue.forEach(invoke$1("call",[null,time])),queue.clear(),frame=void 0,DEBUG$3&&(point.duration=now$2()-point.runTime,console.groupEnd())}function cue(fn){if(!queue.has(fn)){if(!0===frame)return DEBUG$3&&++point.insertedFns,void fn();queue.add(fn),void 0===frame&&(frame=requestAnimationFrame(run))}}function uncue(fn){queue.delete(fn),void 0!==frame&&!0!==frame&&0===queue.size&&(cancelAnimationFrame(frame),frame=void 0)}const DEBUG$4=!1,Observable$1=window.Observable,assign$8=Object.assign,observe=Observable$1.observe;var rtransform=/\|\s*([\w-]+)\s*(?::([^|]+))?/g;var structs=[],removeStruct=remove$2(structs);function Struct(node,token,path,render,pipe$$1){var struct;struct=this,structs.push(struct),this.node=node,this.token=token,this.path=path,this.render=render,this.pipe=pipe$$1}function ReadableStruct(node,token,path,render,type,read,pipe$$1){Struct.call(this,node,token,path,render,pipe$$1),this.type=type,this.read=read}function listen(struct,scope,options){var set;return""===struct.path&&console.warn('mount: Cannot listen to path ""'),set=setPath$1(struct.path,scope),pipe(function(){return struct.read()},function(transformers$$1,string){if(!string)return id;var token,name,fn,args$$1,fns=[];for(rtransform.lastIndex=0;rtransform.lastIndex<string.length&&(token=rtransform.exec(string));){if(!(fn=transformers$$1[name=token[1]].ix))throw new Error('mount:  transformers "'+name+'" not found');token[2]?(args$$1=JSON.parse("["+token[2].replace(/'/g,'"')+"]"),fns.unshift(fn.apply(null,args$$1))):fns.unshift(fn)}return pipe.apply(null,fns)}(transformers,struct.pipe),set)}function unbind(struct){DEBUG$4&&console.log("unbind:",struct.token),struct.input&&struct.input.stop(),struct.unlisten&&struct.unlisten(),struct.scope=void 0}assign$8(Struct.prototype,{render:noop$1,transform:id,stop:function(){uncue(this.cuer),removeStruct(this)},update:function(time){var transform=this.transform,value=this.input&&this.input.shift();DEBUG$4&&console.log("update:",this.token,value,this.originalValue),void 0===value?this.render(this.originalValue):this.render(transform(value))}}),assign$8(ReadableStruct.prototype,Struct.prototype,{listen:function(fn){this._listenFn&&console.warn("Bad Steve. Attempt to listen without removing last listener. Shouldnt happen."),this._listenFn=fn,this.node.addEventListener(this.type,fn)},unlisten:function(){var fn=this._listenFn;this.node.removeEventListener(this.type,fn),this._listenType=void 0,this._listenFn=void 0}}),Struct.Readable=ReadableStruct,Struct.setup=function(struct,options){struct.transform=struct.pipe?parsePipe(struct.pipe.slice(1)):id,struct.originalValue=struct.read?struct.read():"",DEBUG$4&&console.log("setup: ",struct.token,struct.originalValue)},Struct.bind=function(struct,scope,options){DEBUG$4&&console.log("bind:  ",struct.token);var input=struct.input=ObservableStream(struct.path,scope).latest();struct.scope=scope;var change,flag=!1;struct.render?struct.listen?(change=listen(struct,scope),struct.cuer=function updateReadable(){struct.update(),flag||(flag=!0,input.on("push",function(){cue(updateReadable)}),void 0===getPath$1(struct.path,scope)&&change())},cue(struct.cuer),struct.listen(change)):(struct.cuer=function update(){struct.update(),flag||(flag=!0,input.on("push",function(){cue(update)}))},cue(struct.cuer)):(DEBUG$4&&console.log("struct is Sparky"),function(stream,fn){var unobserve=noop$1;function update(time){var scope=stream.shift();function render(time){fn(scope)}void 0!==scope&&(unobserve(),unobserve=observe(scope,"",function(){cue(render)}))}cue(update),stream.on&&stream.on("push",function(){cue(update)})}(input,struct.push))},Struct.listen=listen,Struct.unbind=unbind,Struct.teardown=function(struct){DEBUG$4&&console.log("teardown",struct.token),unbind(struct),struct.stop()},Struct.findScope=function(node){return get$1("scope",structs.find(function(struct){return struct.node===node}))};const DEBUG$5=!1,A$6=Array.prototype,assign$9=Object.assign,attribute$2=dom.attribute,ReadableStruct$1=Struct.Readable,setup$1=Struct.setup,bind$1=Struct.bind,unbind$1=Struct.unbind,teardown$1=Struct.teardown,rspaces$1=/\s+/,rempty=/^\s*$/,rtext=/\S/,rarguments=/function(?:\s+\w+)?\s*(\([\w,\s]*\))/,settings={attributePrefix:"sparky-",mount:noop$1,transforms:{},transformers:{},rtoken:/(\{\[)\s*(.*?)(?:\s*(\|.*?))?\s*(\]\})/g};var cased={viewbox:"viewBox"},toRenderString=overload(toType,{boolean:function(value){return value+""},function:function(value){return(value.name||"function")+(rarguments.exec(value.toString())||[])[1]},number:function(value){return Number.isNaN(value)?"":Number.isFinite(value)?value+"":value<0?"-∞":"∞"},string:id,symbol:function(value){return value.toString()},undefined:function(){return""},object:function(value){return value?JSON.stringify(value):""},default:JSON.stringify});function isTruthy(value){return!!value}function matchToken(string,options){var rtoken=options.rtoken;return rtoken.lastIndex=0,rtoken.exec(string)}function mountStringToken(node,render,strings,structs,match){var i=strings.length;strings.push(""),structs.push(new Struct(node,match[0],match[2],function(value){strings[i]=toRenderString(value),render(strings)},match[3]))}function mountString(node,string,render,options,structs){var rtoken=options.rtoken,i=rtoken.lastIndex=0,match=rtoken.exec(string);if(match){for(var strings=[],renderStrings=function(strings){render(strings.join(""))};match;)match.index>i&&strings.push(string.slice(i,match.index)),mountStringToken(node,renderStrings,strings,structs,match),i=rtoken.lastIndex,match=rtoken.exec(string);string.length>i&&strings.push(string.slice(i))}}function mountAttributes(names,node,options,structs){for(var name;name=names.shift();)mountAttribute(name,node,options,structs)}function mountAttribute(name,node,options,structs,prefixed){var text=!1!==prefixed&&node.getAttribute(options.attributePrefix+name)||node.getAttribute(cased[name]||name);return text&&mountString(node,text,function(value){node.setAttribute(cased[name]||name,value)},options,structs)}function mountBooleanToken(node,render,values,structs,match){var i=values.length;values.push(!1),structs.push(new Struct(node,match[0],match[2],function(value){values[i]=value,render(values)},match[3]))}function mountBoolean(name,node,options,structs){var prefixed=node.getAttribute(options.attributePrefix+name),string=prefixed||node.getAttribute(name);if(string){var rtoken=options.rtoken,i=rtoken.lastIndex=0,match=rtoken.exec(string);if(match){var render=function(name,node){return name in node?function(values){node[name]=!!values.find(isTruthy)}:function(values){values.find(isTruthy)?node.setAttribute(name,name):node.removeAttribute(name)}}(name,node);prefixed||render(nothing$1);for(var value,values=[];match;)match.index>i&&(value=string.slice(i,match.index),rempty.test(value)||values.push(value)),mountBooleanToken(node,render,values,structs,match),i=rtoken.lastIndex,match=rtoken.exec(string);string.length>i&&(value=string.slice(i),rempty.test(value)||values.push(value))}}}function mountClass(node,options,structs){var rtoken=options.rtoken,attr=dom.attribute("class",node);if(attr){var classes=dom.classes(node),text=attr.replace(rtoken,function($0,$1,$2,$3,$4){var prev="";return structs.push(new Struct(node,$0,$2,function(string){prev&&rtext.test(prev)&&function(classList,text){var classes=toRenderString(text).trim().split(rspaces$1);classList.remove.apply(classList,classes)}(classes,prev),string&&rtext.test(string)&&function(classList,text){var classes=toRenderString(text).trim().split(rspaces$1);classList.add.apply(classList,classes)}(classes,string),prev=string},$3)),""});node.setAttribute("class",text)}}function mountValueNumber(node,options,structs){var match=matchToken(attribute$2(options.attributePrefix+"value",node)||attribute$2("value",node),options);match&&structs.push(new ReadableStruct$1(node,match[0],match[2],writeValueNumber,"input",readValueNumber,match[3]))}function mountValueString(node,options,structs){var match=matchToken(attribute$2(options.attributePrefix+"value",node)||attribute$2("value",node),options);match&&structs.push(new ReadableStruct$1(node,match[0],match[2],writeValue,"input",readValue,match[3]))}function writeValue(value){var node=this.node;value!==node.value&&(node.value="string"==typeof value?value:"")}function writeValueNumber(value){var node=this.node;value!==parseFloat(node.value)&&(node.value="number"!=typeof value||Number.isNaN(value)?"":value)}function writeValueCheckbox(value){var node=this.node;node.checked=isDefined(node.getAttribute("value"))?value===node.value:!0===value}function writeValueRadio(value){var node=this.node;node.checked=isDefined(node.getAttribute("value"))?value===node.value:!0===value}function readValue(){return this.node.value}function readValueNumber(){var node=this.node;return node.value?parseFloat(node.value):void 0}function readValueCheckbox(){var node=this.node;return isDefined(node.getAttribute("value"))?node.checked?node.value:void 0:node.checked}function readValueRadio(){var node=this.node;if(node.checked)return isDefined(node.getAttribute("value"))?node.value:node.checked}const types$1={1:function(node,options,structs){for(var child,children=A$6.slice.apply(node.childNodes),n=-1;child=children[++n];)options.mount(child,options,structs)||mountNode(child,options,structs);mountClass(node,options,structs),mountBoolean("hidden",node,options,structs),mountAttributes(["id","title","style"],node,options,structs),mountTag(node,options,structs)},3:function(node,options,structs){mountString(node,node.nodeValue,set$1("nodeValue",node),options,structs)},8:noop$1,9:function(node,options,structs){for(var child,children=A$6.slice.apply(node.childNodes),n=-1;child=children[++n];)options.mount(child,options,structs)||mountNode(child,options,structs)},10:noop$1,11:function(node,options,structs){for(var child,children=A$6.slice.apply(node.childNodes),n=-1;child=children[++n];)options.mount(child,options,structs)||mountNode(child,options,structs)}},tags={a:function(node,options,structs){mountAttribute("href",node,options,structs)},button:function(node,options,structs){mountBoolean("disabled",node,options,structs)},form:function(node,options,structs){mountAttribute("method",node,options,structs),mountAttribute("action",node,options,structs)},fieldset:function(node,options,structs){mountBoolean("disabled",node,options,structs)},img:function(node,options,structs){mountAttribute("alt",node,options,structs)},input:function(node,options,structs){mountBoolean("disabled",node,options,structs),mountBoolean("required",node,options,structs),mountAttribute("name",node,options,structs),mountInput(node,options,structs)},label:function(node,options,structs){mountAttribute("for",node,options,structs)},meter:function(node,options,structs){mountAttributes(["min","max","low","high","value"],node,options,structs)},option:function(node,options,structs){mountBoolean("disabled",node,options,structs),mountAttribute("value",node,options,structs)},output:function(node,options,structs){mountAttribute("for",node,options,structs)},progress:function(node,options,structs){mountAttribute(["max","value"],node,options,structs)},select:function(node,options,structs){mountBoolean("disabled",node,options,structs),mountBoolean("required",node,options,structs),mountAttribute("name",node,options,structs),mountValueString(node,options,structs)},textarea:function(node,options,structs){mountBoolean("disabled",node,options,structs),mountBoolean("required",node,options,structs),mountAttribute("name",node,options,structs),mountValueString(node,options,structs)},time:function(node,options,structs){mountAttributes(["datetime"],node,options,structs)},svg:function(node,options,structs){mountAttributes(["viewbox"],node,options,structs)},g:function(node,options,structs){mountAttributes(["transform"],node,options,structs)},path:function(node,options,structs){mountAttributes(["d","transform"],node,options,structs)},line:function(node,options,structs){mountAttributes(["x1","x2","y1","y2","transform"],node,options,structs)},rect:function(node,options,structs){mountAttributes(["x","y","width","height","rx","ry","transform"],node,options,structs)},text:function(node,options,structs){mountAttributes(["x","y","dx","dy","text-anchor","transform"],node,options,structs)},use:function(node,options,structs){mountAttributes(["href","transform"],node,options,structs)},default:noop$1},inputs={button:function(node,options,structs){mountAttribute("value",node,options,structs,!1)},checkbox:function(node,options,structs){mountAttribute("value",node,options,structs,!1),mountBoolean("checked",node,options,structs),function(node,options,structs){var match=matchToken(attribute$2(options.attributePrefix+"value",node),options);match&&structs.push(new ReadableStruct$1(node,match[0],match[2],writeValueCheckbox,"change",readValueCheckbox,match[3]))}(node,options,structs)},date:function(node,options,structs){mountAttributes(["min","max","step"],node,options,structs),mountValueString(node,options,structs)},hidden:function(node,options,structs){mountAttribute("value",node,options,structs,!1)},image:function(node,options,structs){mountAttribute("src",node,options,structs)},number:function(node,options,structs){mountAttributes(["min","max","step"],node,options,structs),mountValueNumber(node,options,structs)},radio:function(node,options,structs){mountAttribute("value",node,options,structs,!1),mountBoolean("checked",node,options,structs),function(node,options,structs){var match=matchToken(attribute$2(options.attributePrefix+"value",node),options);match&&structs.push(new ReadableStruct$1(node,match[0],match[2],writeValueRadio,"change",readValueRadio,match[3]))}(node,options,structs)},range:function(node,options,structs){mountAttributes(["min","max","step"],node,options,structs),mountValueNumber(node,options,structs)},reset:function(node,options,structs){mountAttribute("value",node,options,structs,!1)},submit:function(node,options,structs){mountAttribute("value",node,options,structs,!1)},time:function(node,options,structs){mountAttributes(["min","max","step"],node,options,structs),mountValueString(node,options,structs)},default:function(node,options,structs){mountValueString(node,options,structs)}},mountNode=overload(get$1("nodeType"),types$1),mountTag=overload(dom.tag,tags),mountInput=overload(get$1("type"),inputs);function setupStructs(structs,options){structs.forEach(function(struct){struct.render&&setup$1(struct,options)})}function unbindStructs(structs){structs.forEach(unbind$1)}function mount(node,options){DEBUG$5&&console.groupCollapsed("mount: ",node),options=assign$9({},settings,options);var structs=[];mountNode(node,options,structs),DEBUG$5&&console.groupEnd();var old,fn=setupStructs;return{shift:noop$1,stop:function(){structs.forEach(teardown$1)},push:function(scope){old!==scope&&(old=scope,fn(structs,options),fn=unbindStructs,structs.forEach(function(struct){bind$1(struct,scope,options)}))}}}mount.types=types$1,mount.tags=tags,mount.inputs=inputs,mount.mountAttribute=mountAttribute,mount.mountBoolean=mountBoolean,mount.mountInput=mountInput,mount.mountValueString=mountValueString,mount.mountValueNumber=mountValueNumber,mount.getScope=function getScope(node){var scope=Struct.findScope(node);return void 0===scope&&node.parentNode?getScope(node.parentNode):scope};var DEBUG$6=window.DEBUG,Observable$2=window.Observable,assign$10=Object.assign,tag$2=dom.tag,preventDefault$2=dom.preventDefault,rfn=/\s*([-\w]+)(?:\s*:\s*((?:"[^"]*"|'[^']*'|[^\s,]+)(?:\s*,\s*(?:"[^"]*"|'[^']*'|[^\s,]+))*))?/,settings$1={mount:function(node,options,streams){var fn=dom.attribute(Sparky.attributeFn,node);if(fn){var sparky=new Sparky(node,void 0,{fn:fn,suppressLogs:!0});return sparky.token=fn,sparky.path="",streams.push(sparky),!0}}};function toObservableOrSelf(object){return Observable$2(object)||object}function Sparky(selector,data,options){if(!Sparky.prototype.isPrototypeOf(this))return new Sparky(selector,data,options);var node="string"==typeof selector?document.querySelector(function(selector){return selector.replace(/\//g,"\\/")}(selector)):selector;if(!node)throw new Error('Sparky: "'+selector+'" not found.');var input,fnstring=options&&options.fn||dom.attribute(Sparky.attributeFn,node)||"",calling=!0,sparky=this,renderer=nothing$1;function render(){settings$1.attributePrefix=Sparky.attributePrefix,!DEBUG$6||options&&options.suppressLogs||console.groupCollapsed("Sparky:",selector),renderer=function(sparky,settings){for(var streams=[],n=-1;sparky[++n];)streams.push(mount(sparky[n],settings));return{stop:function(){return streams.forEach(invoke$1("stop",arguments))},push:function(){return streams.forEach(invoke$1("push",arguments))}}}(sparky,settings$1),input.each(renderer.push),!DEBUG$6||options&&options.suppressLogs||console.groupEnd()}function start(){var token=fnstring.match(rfn);if(!token)return sparky.continue=noop$1,render(),sparky;var fn=Sparky.fn[token[1]];if(!fn)throw new Error('Sparky: fn "'+token[1]+'" not found in Sparky.fn');var params=token[2]?parseParams([],token[2]):nothing$1;calling=!0,fnstring=fnstring.slice(token[0].length);var output=fn.call(sparky,node,input,params);return input=output?output.map(toObservableOrSelf).dedup():input,calling&&start()}this[0]=node,this.length=1,Stream$1.call(this,function(notify,stop){this.shift=function(){var object;if(void 0!==data)return object=data,data=void 0,object},this.push=function(){data=arguments[arguments.length-1],notify("push")},this.stop=function(){input.stop&&input.stop!==sparky.stop&&input.stop(),renderer.stop&&renderer.stop(),stop(data?1:0)}}),input=this.map(toObservableOrSelf).dedup(),this.interrupt=function(){return calling=!1,{fn:fnstring}},this.continue=start,start()}Sparky.prototype=Stream$1.prototype,assign$10(Sparky,{attributeFn:"sparky-fn",attributePrefix:"sparky-",fn:{global:function(node,stream,params){var scope=getPath$1(params[0],window);return void 0===scope?(console.warn("Sparky.fn.global:path – no object at path "+params[0]),Fn$1.of()):Fn$1.of(scope)},get:function(node,input,params){var output=Stream$1.of(),stop=noop$1;return input.each(function(object){stop(),stop=ObservableStream(params[0],object).each(output.push).stop}),this.then(function(){stop()}),output},if:function(node,stream,params){var name=params[0],mark=Sparky.MarkerNode(node),visible=!1;return dom.before(node,mark),dom.remove(node),stream.tap(function(scope){var visibility=!!scope[name];visibility!==visible&&((visible=visibility)?dom.replace(mark,node):dom.replace(node,mark))})},stop:function(node,stream){this.interrupt()},"prevent-on":function(node,stream,params){node.addEventListener(params[0],preventDefault$2),this.then(function(){node.removeEventListener(params[0],preventDefault$2)})},debug:function(node,scopes){var sparky=this;return console.group("Sparky: run  ",node),console.log("data ",sparky.data),console.groupEnd("---"),scopes.tap(function(scope){console.group("Sparky: scope",node),console.log("data ",sparky.data),console.log("scope",scope),console.log("fn   ",sparky.fn),console.groupEnd("---")})},scope:deprecate(function(node,stream,params){return Sparky.fn.find.apply(this,arguments)},"Deprecated Sparky fn scope:path renamed find:path"),ignore:deprecate(function(node,stream){console.log(this.interrupt(),node,stream)},'Sparky: fn "ignore" renamed "stop".')},transforms:{},MarkerNode:function(node){if(!DEBUG$6)return dom.create("text","");var attrFn=node&&node.getAttribute(Sparky.attributeFn);return dom.create("comment",tag$2(node)+(attrFn?" "+Sparky.attributeFn+'="'+attrFn+'"':""))},getScope:mount.getScope}),Object.defineProperties(Sparky,{rtoken:{get:function(){return settings$1.rtoken},set:function(rtoken){settings$1.rtoken=rtoken},enumerable:!0,configurable:!0}});var DEBUG$7=!1,Observable$3=window.Observable,A$7=Array.prototype,isArray=Array.isArray,before$2=dom.before,clone$2=dom.clone,remove$5=dom.remove,tag$3=dom.tag,observe$1=Observable$3.observe,MarkerNode=Sparky.MarkerNode,$object=Symbol("object");function create$3(node,object,options){DEBUG$7&&console.groupCollapsed("each: create",node);var sparky=new Sparky(node,object,options);return DEBUG$7&&console.groupEnd(),sparky[$object]=object,sparky}function entryToKeyValue(entry){return{key:entry[0],value:entry[1]}}Sparky.fn.each=function(node,scopes,params){var sparkies=[],template=node.cloneNode(!0),options=this.interrupt(),marker=MarkerNode(node),isSelect="option"===tag$3(node);template.removeAttribute(Sparky.attributeFn),before$2(node,marker),remove$5(node);var unEachFrame=function(stream,fn){var unobserve=noop$1;function update(time){var scope=stream.shift();if(void 0!==scope){unobserve();var uno=observe$1(scope,"",function(){cue(render)});unobserve=function(){uno(),uncue(render)}}function render(time){fn(scope)}}function push(){cue(update)}return stream.on?stream.on("push",push):push(),function(){stream.off("push",push),unobserve(),uncue(update)}}(scopes.latest().dedup(),function(array){var value=isSelect?marker.parentNode.value:void 0;isArray(array)||(array=Object.entries(array).map(entryToKeyValue)),DEBUG$7&&console.log("render: each "+JSON.stringify(array)),function(template,options,array,sparkies){for(var sparky,object,i,n=-1;++n<array.length;)if(object=array[n],!(sparky=sparkies[n])||object!==sparky[$object]){for(i=n-1;sparkies[++i]&&sparkies[i][$object]!==object;);sparky=i===sparkies.length?create$3(clone$2(template),object,options):sparkies.splice(i,1)[0],sparkies.splice(n,0,sparky)}for(;sparkies.length>array.length;)A$7.forEach.call(sparkies.pop().stop(),remove$5)}(template,options,array,sparkies),function(node,array,sparkies){for(var l=sparkies.length,n=-1,parent=node.parentNode;n<l;)for(node=node?node.nextSibling:null;++n<l&&sparkies[n][0]!==node;)parent.insertBefore(sparkies[n][0],node)}(marker,0,sparkies),isSelect&&void 0!==value&&(marker.parentNode.value=value)});this.then(function(){remove$5(marker),unEachFrame(),sparkies.forEach(function(sparky){sparky.stop()})})};var DEBUG$8=!1,axios=window.axios,jQuery=window.jQuery,assign$11=Object.assign,fetch=window.fetch,getData=get$1("data"),parseHTML=dom.parse("html"),cache$1={"":{"":document}},request$1=axios?function(url,id$$1){return axios.get(url).then(getData).then(parseHTML)}:jQuery?function(url,id$$1){return jQuery.get(url).then(getData).then(parseHTML)}:fetch?function(url,id$$1){return fetch(url).then(getData).then(parseHTML)}:function(url,id$$1){throw new Error('Sparky: no axios, jQuery or fetch found for request "'+url+'"')};function insertTemplate(sparky,node,scopes,id$$1,template){if(!template)throw new Error("Sparky: template "+id$$1+" not found.");var run=function(){run=noop$1;var fragment=dom.clone(template);dom.empty(node),dom.append(node,fragment),DEBUG$8&&console.log("Sparky fn=template:",node),sparky.continue()},stream=Stream$1.of();return scopes.each(function(scope){cue(function(){run(),stream.push(scope)})}),stream}function templateFromDocument(sparky,node,scopes,path,id$$1){var stream=Stream$1.of();return request$1(path).then(function(doc){if(doc){var tapped=function(sparky,node,scopes,path,id$$1,doc){var template,elem;if(cache$1[path]={"":doc},!id$$1)throw new Error("Sparky: template url has no hash id "+path);elem=doc.getElementById(id$$1),template=cache$1[path][id$$1]=elem&&dom.fragmentFromHTML(elem.innerHTML);return insertTemplate(sparky,node,scopes,id$$1,template)}(sparky,node,scopes,path,id$$1,doc);sparky.continue(),tapped.each(stream.push)}}).catch(function(error){console.warn(error)}),stream}assign$11(Sparky.fn,{template:function(node,scopes,params){var parts,path,id$$1,url=params[0];if(/#/.test(url)?(path=(parts=url.split("#"))[0]||"",id$$1=parts[1]||""):(console.warn('Deprecated: Sparky template:url url should be a url or hash ref, actually an id: "'+url+'"'),path="",id$$1=url),DEBUG$8&&!id$$1)throw new Error("Sparky: "+Sparky.attributePrefix+'fn="template:url" requires a url with a hash ref. "'+url+'"');return this.interrupt(),cache$1[path]?function(sparky,node,scopes,path,id$$1){var doc,elem,template=cache$1[path][id$$1];return template||(elem=(doc=cache$1[path][""]).getElementById(id$$1),template=cache$1[path][id$$1]=doc===document?dom.fragmentFromId(id$$1):elem&&dom.fragmentFromHTML(elem.innerHTML)),insertTemplate(sparky,node,scopes,id$$1,template)}(this,node,scopes,path,id$$1):templateFromDocument(this,node,scopes,path,id$$1)},"template-from":function(node,scopes,params){var string=params[0],sparky=this,outputScopes=Stream$1.of();if(sparky.interrupt(),/\$\{([\w._]+)\}/.test(string))return scopes.each(function(scope){var notParsed=!1,url=string.replace(/\$\{([\w._]+)\}/g,function($0,$1){var value=getPath$1($1,scope);return void 0===value&&(notParsed=!0),value});if(notParsed)console.log("Sparky: template-from not properly assembled from scope",string,scope);else{var parts=url.split("#"),path=parts[0]||"",id$$1=parts[1]||"";if(DEBUG$8&&!id$$1)throw new Error("Sparky: "+Sparky.attributePrefix+'fn="template:url" requires a url with a hash ref. "'+url+'"');cache$1[path]?(!function(sparky,node,scopes,path,id$$1,template){var doc,elem;if(template||(elem=(doc=cache$1[path][""]).getElementById(id$$1),template=cache$1[path][id$$1]=doc===document?dom.fragmentFromId(id$$1):elem&&dom.fragmentFromHTML(elem.innerHTML)),!template)throw new Error("Sparky: template "+id$$1+" not found.");var fragment=dom.clone(template);dom.empty(node),dom.append(node,fragment),sparky.continue()}(sparky,node,0,path,id$$1,cache$1[path][id$$1]),outputScopes.push(scope)):request$1(path).then(function(doc){doc&&templateFromDocument(sparky,node,scopes,path,id$$1)}).catch(function(error){console.warn(error)})}}),outputScopes;throw new Error("Sparky: template-from must have ${prop} in the url string")}}),function(window){var DEBUG=window.DEBUG,axios=window.axios,jQuery=window.jQuery,assign=Object.assign,fetch=window.fetch,getData=get$1("data"),cache$$1={},request=axios?function(path){return axios.get(path).then(getData)}:jQuery?function(path){return jQuery.get(path).then(getData)}:fetch?function(path){return fetch(path).then(getData)}:function(path){throw new Error('Sparky: no axios, jQuery or fetch found for request "'+path+'"')};function importScope(url,scopes){request(url).then(function(data){data&&(cache$$1[url]=data,scopes.push(data))}).catch(function(error){console.warn("Sparky: no data found at",url)})}assign(Sparky.fn,{load:function(node,stream,params){var path=params[0];if(DEBUG&&!path)throw new Error("Sparky: "+Sparky.attributePrefix+'fn="load:url" requires a url.');var scopes=Stream$1.of();return request(path).then(scopes.push).catch(function(error){console.warn(error)}),scopes},import:function(node,stream,params){var path=params[0];if(DEBUG&&!path)throw new Error("Sparky: "+Sparky.attributePrefix+'fn="import:url" requires a url.');var scopes=Stream$1.of();return/\$\{(\w+)\}/.test(path)?(stream.each(function(scope){var url=path.replace(/\$\{(\w+)\}/g,function($0,$1){return scope[$1]});cache$$1[url]?scopes.push(cache$$1[url]):importScope(url,scopes)}),scopes):cache$$1[path]?Fn$1.of(cache$$1[path]):(importScope(path,scopes),scopes)}})}(window);window.DEBUG;var assign$12=Object.assign,attribute$3=dom.attribute,events$1=dom.events,preventDefault$3=dom.preventDefault;return assign$12(Sparky.fn,{"request-on-submit":function(node,scopes){var scope;return events$1("submit",node).tap(preventDefault$3).each(function(e){var method=attribute$3("method",node),action=attribute$3("action",node);request({url:action,method:method,data:scope,headers:{"X-CSRFToken":function(name){var cookies,cookie,i,cookieValue=null;if(document.cookie&&""!==document.cookie)for(cookies=document.cookie.split(";"),i=0;i<cookies.length;i++)if((cookie=cookies[i]&&cookies[i].trim()).substring(0,name.length+1)===name+"="){cookieValue=decodeURIComponent(cookie.substring(name.length+1));break}return cookieValue}("csrftoken")}}).then(function(object){assign$12(scope,object)}).catch(function(thing){dom.events.trigger(node,"dom-error",{detail:thing.response.data})})}),scopes.tap(function(object){scope=object})}}),window.console&&window.console.log&&console.log("Sparky      - https://github.com/cruncher/sparky"),Sparky}();